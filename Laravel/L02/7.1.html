<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AitSchool | 7.1 活跃用户</title>
    <meta name="description" content="技术成就梦想之美">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/499.styles.12267a2b.css" as="style"><link rel="preload" href="/assets/js/app.8c64503a.js" as="script"><link rel="preload" href="/assets/js/298.ce80c048.js" as="script"><link rel="prefetch" href="/assets/js/0.88fc2358.js"><link rel="prefetch" href="/assets/js/1.60ca915f.js"><link rel="prefetch" href="/assets/js/2.b0d4ec39.js"><link rel="prefetch" href="/assets/js/3.9d9b72af.js"><link rel="prefetch" href="/assets/js/4.192f8085.js"><link rel="prefetch" href="/assets/js/5.4177efbc.js"><link rel="prefetch" href="/assets/js/6.d131d89b.js"><link rel="prefetch" href="/assets/js/7.248b3640.js"><link rel="prefetch" href="/assets/js/8.43bfce3c.js"><link rel="prefetch" href="/assets/js/9.cce4d19c.js"><link rel="prefetch" href="/assets/js/10.22fc6bb9.js"><link rel="prefetch" href="/assets/js/11.3b29fb7c.js"><link rel="prefetch" href="/assets/js/12.7645ad71.js"><link rel="prefetch" href="/assets/js/13.7e63c29c.js"><link rel="prefetch" href="/assets/js/14.c2cd801f.js"><link rel="prefetch" href="/assets/js/15.eb95c8f8.js"><link rel="prefetch" href="/assets/js/16.53e478e9.js"><link rel="prefetch" href="/assets/js/17.8a1ca77e.js"><link rel="prefetch" href="/assets/js/18.b5aa5efe.js"><link rel="prefetch" href="/assets/js/19.a2534c9e.js"><link rel="prefetch" href="/assets/js/20.41856387.js"><link rel="prefetch" href="/assets/js/21.f9e91174.js"><link rel="prefetch" href="/assets/js/22.faa8311c.js"><link rel="prefetch" href="/assets/js/23.fa235125.js"><link rel="prefetch" href="/assets/js/24.b8f1192a.js"><link rel="prefetch" href="/assets/js/25.b02b5515.js"><link rel="prefetch" href="/assets/js/26.8679f6fa.js"><link rel="prefetch" href="/assets/js/27.8331b4a0.js"><link rel="prefetch" href="/assets/js/28.33246a42.js"><link rel="prefetch" href="/assets/js/29.ac28a69f.js"><link rel="prefetch" href="/assets/js/30.ce225449.js"><link rel="prefetch" href="/assets/js/31.2ae097e3.js"><link rel="prefetch" href="/assets/js/32.4399601b.js"><link rel="prefetch" href="/assets/js/33.0b43ea1a.js"><link rel="prefetch" href="/assets/js/34.a9ee1c3d.js"><link rel="prefetch" href="/assets/js/35.f21f37ee.js"><link rel="prefetch" href="/assets/js/36.67c71226.js"><link rel="prefetch" href="/assets/js/37.9d4e2758.js"><link rel="prefetch" href="/assets/js/38.14baf3cf.js"><link rel="prefetch" href="/assets/js/39.7dbe6512.js"><link rel="prefetch" href="/assets/js/40.580423a8.js"><link rel="prefetch" href="/assets/js/41.f87a2e09.js"><link rel="prefetch" href="/assets/js/42.764d1536.js"><link rel="prefetch" href="/assets/js/43.ac78d321.js"><link rel="prefetch" href="/assets/js/44.da0c3404.js"><link rel="prefetch" href="/assets/js/45.6a83afb6.js"><link rel="prefetch" href="/assets/js/46.d94ec96b.js"><link rel="prefetch" href="/assets/js/47.6d323cac.js"><link rel="prefetch" href="/assets/js/48.ade54b3f.js"><link rel="prefetch" href="/assets/js/49.9f406e20.js"><link rel="prefetch" href="/assets/js/50.2124e59e.js"><link rel="prefetch" href="/assets/js/51.068f6682.js"><link rel="prefetch" href="/assets/js/52.c2d45965.js"><link rel="prefetch" href="/assets/js/53.8016ed73.js"><link rel="prefetch" href="/assets/js/54.72bc2e46.js"><link rel="prefetch" href="/assets/js/55.89a8c7eb.js"><link rel="prefetch" href="/assets/js/56.4c0c6535.js"><link rel="prefetch" href="/assets/js/57.06001e23.js"><link rel="prefetch" href="/assets/js/58.b4ee5a98.js"><link rel="prefetch" href="/assets/js/59.199a5d47.js"><link rel="prefetch" href="/assets/js/60.72a07853.js"><link rel="prefetch" href="/assets/js/61.3e1c9b91.js"><link rel="prefetch" href="/assets/js/62.bf1a9136.js"><link rel="prefetch" href="/assets/js/63.31e3df80.js"><link rel="prefetch" href="/assets/js/64.8d68a2c8.js"><link rel="prefetch" href="/assets/js/65.4c3acddf.js"><link rel="prefetch" href="/assets/js/66.9dffdf18.js"><link rel="prefetch" href="/assets/js/67.6c5f9c89.js"><link rel="prefetch" href="/assets/js/68.165b7f48.js"><link rel="prefetch" href="/assets/js/69.07f9edea.js"><link rel="prefetch" href="/assets/js/70.9f320639.js"><link rel="prefetch" href="/assets/js/71.c706adb0.js"><link rel="prefetch" href="/assets/js/72.c7c1584f.js"><link rel="prefetch" href="/assets/js/73.cb9f9414.js"><link rel="prefetch" href="/assets/js/74.65f6fab6.js"><link rel="prefetch" href="/assets/js/75.16f3c601.js"><link rel="prefetch" href="/assets/js/76.0af64646.js"><link rel="prefetch" href="/assets/js/77.36b6a13b.js"><link rel="prefetch" href="/assets/js/78.12be2b67.js"><link rel="prefetch" href="/assets/js/79.35085fe7.js"><link rel="prefetch" href="/assets/js/80.e5058d97.js"><link rel="prefetch" href="/assets/js/81.2831af92.js"><link rel="prefetch" href="/assets/js/82.6a8936f9.js"><link rel="prefetch" href="/assets/js/83.4ab55c15.js"><link rel="prefetch" href="/assets/js/84.ecd46aba.js"><link rel="prefetch" href="/assets/js/85.2129c567.js"><link rel="prefetch" href="/assets/js/86.e0a970f3.js"><link rel="prefetch" href="/assets/js/87.1f4dab74.js"><link rel="prefetch" href="/assets/js/88.b0f99ad1.js"><link rel="prefetch" href="/assets/js/89.bebb4957.js"><link rel="prefetch" href="/assets/js/90.b950a353.js"><link rel="prefetch" href="/assets/js/91.00a43224.js"><link rel="prefetch" href="/assets/js/92.4a526a02.js"><link rel="prefetch" href="/assets/js/93.ef7c81a7.js"><link rel="prefetch" href="/assets/js/94.b725689c.js"><link rel="prefetch" href="/assets/js/95.de02bc77.js"><link rel="prefetch" href="/assets/js/96.76a60666.js"><link rel="prefetch" href="/assets/js/97.238c8a57.js"><link rel="prefetch" href="/assets/js/98.7a34b22e.js"><link rel="prefetch" href="/assets/js/99.9075800a.js"><link rel="prefetch" href="/assets/js/100.f7bbc859.js"><link rel="prefetch" href="/assets/js/101.d98502e1.js"><link rel="prefetch" href="/assets/js/102.f1adc4e0.js"><link rel="prefetch" href="/assets/js/103.17fea761.js"><link rel="prefetch" href="/assets/js/104.7a0c5d9a.js"><link rel="prefetch" href="/assets/js/105.0cb6f672.js"><link rel="prefetch" href="/assets/js/106.a7fa93a4.js"><link rel="prefetch" href="/assets/js/107.1b0da725.js"><link rel="prefetch" href="/assets/js/108.e1fa6f46.js"><link rel="prefetch" href="/assets/js/109.3b56d9b0.js"><link rel="prefetch" href="/assets/js/110.0158017c.js"><link rel="prefetch" href="/assets/js/111.2be2ae13.js"><link rel="prefetch" href="/assets/js/112.6801de53.js"><link rel="prefetch" href="/assets/js/113.5cdc3601.js"><link rel="prefetch" href="/assets/js/114.38df81f6.js"><link rel="prefetch" href="/assets/js/115.8b16b4be.js"><link rel="prefetch" href="/assets/js/116.87be9072.js"><link rel="prefetch" href="/assets/js/117.5e8577ac.js"><link rel="prefetch" href="/assets/js/118.8d9094a0.js"><link rel="prefetch" href="/assets/js/119.53dc2da4.js"><link rel="prefetch" href="/assets/js/120.1e04a362.js"><link rel="prefetch" href="/assets/js/121.130dfac5.js"><link rel="prefetch" href="/assets/js/122.2bcd0629.js"><link rel="prefetch" href="/assets/js/123.ed404964.js"><link rel="prefetch" href="/assets/js/124.fd1908cd.js"><link rel="prefetch" href="/assets/js/125.f45f6642.js"><link rel="prefetch" href="/assets/js/126.32c49e09.js"><link rel="prefetch" href="/assets/js/127.197bd5cc.js"><link rel="prefetch" href="/assets/js/128.0ca85dc2.js"><link rel="prefetch" href="/assets/js/129.9ddd421d.js"><link rel="prefetch" href="/assets/js/130.ef14be6d.js"><link rel="prefetch" href="/assets/js/131.c2676466.js"><link rel="prefetch" href="/assets/js/132.e3a23826.js"><link rel="prefetch" href="/assets/js/133.62f980ee.js"><link rel="prefetch" href="/assets/js/134.fb7bc409.js"><link rel="prefetch" href="/assets/js/135.d5985ff7.js"><link rel="prefetch" href="/assets/js/136.02a567fa.js"><link rel="prefetch" href="/assets/js/137.d955038c.js"><link rel="prefetch" href="/assets/js/138.1f4fcd27.js"><link rel="prefetch" href="/assets/js/139.8b5629d8.js"><link rel="prefetch" href="/assets/js/140.bcae2acf.js"><link rel="prefetch" href="/assets/js/141.8371382f.js"><link rel="prefetch" href="/assets/js/142.3d456486.js"><link rel="prefetch" href="/assets/js/143.1bdfb337.js"><link rel="prefetch" href="/assets/js/144.71fffaf3.js"><link rel="prefetch" href="/assets/js/145.c0bbf668.js"><link rel="prefetch" href="/assets/js/146.2f856c68.js"><link rel="prefetch" href="/assets/js/147.24560fba.js"><link rel="prefetch" href="/assets/js/148.a059a88c.js"><link rel="prefetch" href="/assets/js/149.bedada4a.js"><link rel="prefetch" href="/assets/js/150.42a282c3.js"><link rel="prefetch" href="/assets/js/151.e059deb5.js"><link rel="prefetch" href="/assets/js/152.25f873d8.js"><link rel="prefetch" href="/assets/js/153.12ca2f78.js"><link rel="prefetch" href="/assets/js/154.47db605c.js"><link rel="prefetch" href="/assets/js/155.b43f642e.js"><link rel="prefetch" href="/assets/js/156.6cd1bafc.js"><link rel="prefetch" href="/assets/js/157.14c5db2a.js"><link rel="prefetch" href="/assets/js/158.22846353.js"><link rel="prefetch" href="/assets/js/159.2b12dd54.js"><link rel="prefetch" href="/assets/js/160.0fe5fb12.js"><link rel="prefetch" href="/assets/js/161.e94d2b77.js"><link rel="prefetch" href="/assets/js/162.9c023f47.js"><link rel="prefetch" href="/assets/js/163.da3e83dc.js"><link rel="prefetch" href="/assets/js/164.f8775a6b.js"><link rel="prefetch" href="/assets/js/165.dfd47d19.js"><link rel="prefetch" href="/assets/js/166.8bf5a1d4.js"><link rel="prefetch" href="/assets/js/167.dd42a3fa.js"><link rel="prefetch" href="/assets/js/168.5e0d1f5a.js"><link rel="prefetch" href="/assets/js/169.252337e4.js"><link rel="prefetch" href="/assets/js/170.717d70a6.js"><link rel="prefetch" href="/assets/js/171.d4ef0b55.js"><link rel="prefetch" href="/assets/js/172.e5295d2c.js"><link rel="prefetch" href="/assets/js/173.eb6182bf.js"><link rel="prefetch" href="/assets/js/174.9d0ca9f9.js"><link rel="prefetch" href="/assets/js/175.d18e876f.js"><link rel="prefetch" href="/assets/js/176.83b41082.js"><link rel="prefetch" href="/assets/js/177.c0a501b8.js"><link rel="prefetch" href="/assets/js/178.cda9b7cd.js"><link rel="prefetch" href="/assets/js/179.9d157169.js"><link rel="prefetch" href="/assets/js/180.a1fbf4ad.js"><link rel="prefetch" href="/assets/js/181.e581ceb3.js"><link rel="prefetch" href="/assets/js/182.2f343c73.js"><link rel="prefetch" href="/assets/js/183.2fd6ed7b.js"><link rel="prefetch" href="/assets/js/184.99e01cf2.js"><link rel="prefetch" href="/assets/js/185.7e184a86.js"><link rel="prefetch" href="/assets/js/186.a00ec23d.js"><link rel="prefetch" href="/assets/js/187.c2bcda0f.js"><link rel="prefetch" href="/assets/js/188.e612162a.js"><link rel="prefetch" href="/assets/js/189.9cd66396.js"><link rel="prefetch" href="/assets/js/190.a024b8b2.js"><link rel="prefetch" href="/assets/js/191.18b08639.js"><link rel="prefetch" href="/assets/js/192.322ab1c4.js"><link rel="prefetch" href="/assets/js/193.40b46ecc.js"><link rel="prefetch" href="/assets/js/194.32833e3a.js"><link rel="prefetch" href="/assets/js/195.2eca5344.js"><link rel="prefetch" href="/assets/js/196.dde12043.js"><link rel="prefetch" href="/assets/js/197.6dc3cd61.js"><link rel="prefetch" href="/assets/js/198.3f289008.js"><link rel="prefetch" href="/assets/js/199.969a9e38.js"><link rel="prefetch" href="/assets/js/200.de8f0077.js"><link rel="prefetch" href="/assets/js/201.e6995ba5.js"><link rel="prefetch" href="/assets/js/202.f876c05d.js"><link rel="prefetch" href="/assets/js/203.7e1b4ad4.js"><link rel="prefetch" href="/assets/js/204.8c10989c.js"><link rel="prefetch" href="/assets/js/205.5ad782b9.js"><link rel="prefetch" href="/assets/js/206.8975ab1f.js"><link rel="prefetch" href="/assets/js/207.d7d29ca1.js"><link rel="prefetch" href="/assets/js/208.e5dcd397.js"><link rel="prefetch" href="/assets/js/209.d12da347.js"><link rel="prefetch" href="/assets/js/210.218a96c7.js"><link rel="prefetch" href="/assets/js/211.0155de67.js"><link rel="prefetch" href="/assets/js/212.f9dc9a3b.js"><link rel="prefetch" href="/assets/js/213.bf90f9ee.js"><link rel="prefetch" href="/assets/js/214.968ecd66.js"><link rel="prefetch" href="/assets/js/215.befe282f.js"><link rel="prefetch" href="/assets/js/216.e9f5a499.js"><link rel="prefetch" href="/assets/js/217.1b8dad47.js"><link rel="prefetch" href="/assets/js/218.d939e092.js"><link rel="prefetch" href="/assets/js/219.ae142e9f.js"><link rel="prefetch" href="/assets/js/220.a06315e2.js"><link rel="prefetch" href="/assets/js/221.8a7c03bf.js"><link rel="prefetch" href="/assets/js/222.1d132cf7.js"><link rel="prefetch" href="/assets/js/223.a3b76fce.js"><link rel="prefetch" href="/assets/js/224.033a0702.js"><link rel="prefetch" href="/assets/js/225.63b54587.js"><link rel="prefetch" href="/assets/js/226.665adb15.js"><link rel="prefetch" href="/assets/js/227.15bf10f7.js"><link rel="prefetch" href="/assets/js/228.d4e1b79b.js"><link rel="prefetch" href="/assets/js/229.0303e4b9.js"><link rel="prefetch" href="/assets/js/230.c44133e1.js"><link rel="prefetch" href="/assets/js/231.3a6cafee.js"><link rel="prefetch" href="/assets/js/232.f96430c8.js"><link rel="prefetch" href="/assets/js/233.1fe08012.js"><link rel="prefetch" href="/assets/js/234.7b07da1f.js"><link rel="prefetch" href="/assets/js/235.28169098.js"><link rel="prefetch" href="/assets/js/236.91cf4cf6.js"><link rel="prefetch" href="/assets/js/237.b5c0e89e.js"><link rel="prefetch" href="/assets/js/238.59b8e17d.js"><link rel="prefetch" href="/assets/js/239.7116e744.js"><link rel="prefetch" href="/assets/js/240.58439792.js"><link rel="prefetch" href="/assets/js/241.3ca215e8.js"><link rel="prefetch" href="/assets/js/242.79a0970a.js"><link rel="prefetch" href="/assets/js/243.6c104851.js"><link rel="prefetch" href="/assets/js/244.94af4ca6.js"><link rel="prefetch" href="/assets/js/245.258f69cc.js"><link rel="prefetch" href="/assets/js/246.cdbadb70.js"><link rel="prefetch" href="/assets/js/247.bfb09ad3.js"><link rel="prefetch" href="/assets/js/248.cdf3f595.js"><link rel="prefetch" href="/assets/js/249.c79af26b.js"><link rel="prefetch" href="/assets/js/250.32edff71.js"><link rel="prefetch" href="/assets/js/251.5f900e99.js"><link rel="prefetch" href="/assets/js/252.6c1b3c6c.js"><link rel="prefetch" href="/assets/js/253.5427022f.js"><link rel="prefetch" href="/assets/js/254.99161875.js"><link rel="prefetch" href="/assets/js/255.48f9597e.js"><link rel="prefetch" href="/assets/js/256.9255fe08.js"><link rel="prefetch" href="/assets/js/257.fe7a7386.js"><link rel="prefetch" href="/assets/js/258.f7129b51.js"><link rel="prefetch" href="/assets/js/259.826f9688.js"><link rel="prefetch" href="/assets/js/260.75ab7e50.js"><link rel="prefetch" href="/assets/js/261.8f3e35a0.js"><link rel="prefetch" href="/assets/js/262.5f282380.js"><link rel="prefetch" href="/assets/js/263.32c6f479.js"><link rel="prefetch" href="/assets/js/264.e4199b4f.js"><link rel="prefetch" href="/assets/js/265.f89dea38.js"><link rel="prefetch" href="/assets/js/266.755be615.js"><link rel="prefetch" href="/assets/js/267.0e7b7e8d.js"><link rel="prefetch" href="/assets/js/268.7d990e3d.js"><link rel="prefetch" href="/assets/js/269.6e997320.js"><link rel="prefetch" href="/assets/js/270.7e342e55.js"><link rel="prefetch" href="/assets/js/271.fd73a77f.js"><link rel="prefetch" href="/assets/js/272.3840ce7a.js"><link rel="prefetch" href="/assets/js/273.8dd421cd.js"><link rel="prefetch" href="/assets/js/274.a07d192f.js"><link rel="prefetch" href="/assets/js/275.356834cb.js"><link rel="prefetch" href="/assets/js/276.fce52094.js"><link rel="prefetch" href="/assets/js/277.9993b976.js"><link rel="prefetch" href="/assets/js/278.a5e04ae4.js"><link rel="prefetch" href="/assets/js/279.bf070787.js"><link rel="prefetch" href="/assets/js/280.07e99bfc.js"><link rel="prefetch" href="/assets/js/281.52acbada.js"><link rel="prefetch" href="/assets/js/282.2ed92736.js"><link rel="prefetch" href="/assets/js/283.54434353.js"><link rel="prefetch" href="/assets/js/284.a6ca871d.js"><link rel="prefetch" href="/assets/js/285.975a84a4.js"><link rel="prefetch" href="/assets/js/286.82cbd5cd.js"><link rel="prefetch" href="/assets/js/287.82f522cb.js"><link rel="prefetch" href="/assets/js/288.9be96617.js"><link rel="prefetch" href="/assets/js/289.a93c1290.js"><link rel="prefetch" href="/assets/js/290.2c69c8a5.js"><link rel="prefetch" href="/assets/js/291.4b3f647d.js"><link rel="prefetch" href="/assets/js/292.fd4ef2dd.js"><link rel="prefetch" href="/assets/js/293.a33d7820.js"><link rel="prefetch" href="/assets/js/294.7139d6c5.js"><link rel="prefetch" href="/assets/js/295.421420a6.js"><link rel="prefetch" href="/assets/js/296.9c3231d6.js"><link rel="prefetch" href="/assets/js/297.ab34deee.js"><link rel="prefetch" href="/assets/js/299.0264dad7.js"><link rel="prefetch" href="/assets/js/300.61a5328f.js"><link rel="prefetch" href="/assets/js/301.95025cfe.js"><link rel="prefetch" href="/assets/js/302.bea4d770.js"><link rel="prefetch" href="/assets/js/303.93b18e45.js"><link rel="prefetch" href="/assets/js/304.c1769477.js"><link rel="prefetch" href="/assets/js/305.78d9c4f9.js"><link rel="prefetch" href="/assets/js/306.eca23cfe.js"><link rel="prefetch" href="/assets/js/307.bd1933ca.js"><link rel="prefetch" href="/assets/js/308.90037466.js"><link rel="prefetch" href="/assets/js/309.da7dfa7e.js"><link rel="prefetch" href="/assets/js/310.a87fd635.js"><link rel="prefetch" href="/assets/js/311.a4b693f7.js"><link rel="prefetch" href="/assets/js/312.d42aa095.js"><link rel="prefetch" href="/assets/js/313.101dae88.js"><link rel="prefetch" href="/assets/js/314.8ab7a51d.js"><link rel="prefetch" href="/assets/js/315.79c0fa39.js"><link rel="prefetch" href="/assets/js/316.3fa37331.js"><link rel="prefetch" href="/assets/js/317.350c7571.js"><link rel="prefetch" href="/assets/js/318.4cd2a8c9.js"><link rel="prefetch" href="/assets/js/319.ba360f0d.js"><link rel="prefetch" href="/assets/js/320.9f12fd41.js"><link rel="prefetch" href="/assets/js/321.4b8bf74b.js"><link rel="prefetch" href="/assets/js/322.94257572.js"><link rel="prefetch" href="/assets/js/323.8d274f3a.js"><link rel="prefetch" href="/assets/js/324.e948d936.js"><link rel="prefetch" href="/assets/js/325.2f070cc7.js"><link rel="prefetch" href="/assets/js/326.02f51272.js"><link rel="prefetch" href="/assets/js/327.213e52c7.js"><link rel="prefetch" href="/assets/js/328.148b3b03.js"><link rel="prefetch" href="/assets/js/329.61608755.js"><link rel="prefetch" href="/assets/js/330.fec7d9df.js"><link rel="prefetch" href="/assets/js/331.bee9c11d.js"><link rel="prefetch" href="/assets/js/332.669c33a2.js"><link rel="prefetch" href="/assets/js/333.39399bc6.js"><link rel="prefetch" href="/assets/js/334.6b5bc719.js"><link rel="prefetch" href="/assets/js/335.46d5e60e.js"><link rel="prefetch" href="/assets/js/336.9716f6a6.js"><link rel="prefetch" href="/assets/js/337.2fdb9aaf.js"><link rel="prefetch" href="/assets/js/338.527fd99c.js"><link rel="prefetch" href="/assets/js/339.aa8226bf.js"><link rel="prefetch" href="/assets/js/340.bbbcc246.js"><link rel="prefetch" href="/assets/js/341.ac4e7106.js"><link rel="prefetch" href="/assets/js/342.616d0132.js"><link rel="prefetch" href="/assets/js/343.4f0aa045.js"><link rel="prefetch" href="/assets/js/344.7fa2a130.js"><link rel="prefetch" href="/assets/js/345.c039cf15.js"><link rel="prefetch" href="/assets/js/346.2483de0a.js"><link rel="prefetch" href="/assets/js/347.21290793.js"><link rel="prefetch" href="/assets/js/348.4e5a4ac9.js"><link rel="prefetch" href="/assets/js/349.bc39723a.js"><link rel="prefetch" href="/assets/js/350.4994e747.js"><link rel="prefetch" href="/assets/js/351.6b1897d7.js"><link rel="prefetch" href="/assets/js/352.7e2ada88.js"><link rel="prefetch" href="/assets/js/353.1ced2397.js"><link rel="prefetch" href="/assets/js/354.28b9da77.js"><link rel="prefetch" href="/assets/js/355.29942184.js"><link rel="prefetch" href="/assets/js/356.c5ec1df4.js"><link rel="prefetch" href="/assets/js/357.a2b042c4.js"><link rel="prefetch" href="/assets/js/358.f7c81f82.js"><link rel="prefetch" href="/assets/js/359.fd859e36.js"><link rel="prefetch" href="/assets/js/360.ec3561bc.js"><link rel="prefetch" href="/assets/js/361.f41fe199.js"><link rel="prefetch" href="/assets/js/362.69c70c99.js"><link rel="prefetch" href="/assets/js/363.1702181a.js"><link rel="prefetch" href="/assets/js/364.824dfd6b.js"><link rel="prefetch" href="/assets/js/365.1eeb4973.js"><link rel="prefetch" href="/assets/js/366.a926d040.js"><link rel="prefetch" href="/assets/js/367.6f5c3eda.js"><link rel="prefetch" href="/assets/js/368.4fb65e1c.js"><link rel="prefetch" href="/assets/js/369.d96964eb.js"><link rel="prefetch" href="/assets/js/370.492f3b09.js"><link rel="prefetch" href="/assets/js/371.aa401467.js"><link rel="prefetch" href="/assets/js/372.4e7d3e4a.js"><link rel="prefetch" href="/assets/js/373.ed6d1b15.js"><link rel="prefetch" href="/assets/js/374.de74b2e6.js"><link rel="prefetch" href="/assets/js/375.d4102228.js"><link rel="prefetch" href="/assets/js/376.b7a1585f.js"><link rel="prefetch" href="/assets/js/377.cfc390f5.js"><link rel="prefetch" href="/assets/js/378.1184d756.js"><link rel="prefetch" href="/assets/js/379.a6411f61.js"><link rel="prefetch" href="/assets/js/380.741bfb4b.js"><link rel="prefetch" href="/assets/js/381.193060a0.js"><link rel="prefetch" href="/assets/js/382.21556693.js"><link rel="prefetch" href="/assets/js/383.a820e5fc.js"><link rel="prefetch" href="/assets/js/384.93f69ee9.js"><link rel="prefetch" href="/assets/js/385.b3c6a465.js"><link rel="prefetch" href="/assets/js/386.14a37e8a.js"><link rel="prefetch" href="/assets/js/387.91f832fa.js"><link rel="prefetch" href="/assets/js/388.eee34ec3.js"><link rel="prefetch" href="/assets/js/389.297f4874.js"><link rel="prefetch" href="/assets/js/390.b28b6f53.js"><link rel="prefetch" href="/assets/js/391.a029ae3e.js"><link rel="prefetch" href="/assets/js/392.24549e00.js"><link rel="prefetch" href="/assets/js/393.f99baca2.js"><link rel="prefetch" href="/assets/js/394.9d99ecd4.js"><link rel="prefetch" href="/assets/js/395.a3e8825d.js"><link rel="prefetch" href="/assets/js/396.42baf35c.js"><link rel="prefetch" href="/assets/js/397.7283f9b6.js"><link rel="prefetch" href="/assets/js/398.5dadbcb0.js"><link rel="prefetch" href="/assets/js/399.05d794dd.js"><link rel="prefetch" href="/assets/js/400.fa38d556.js"><link rel="prefetch" href="/assets/js/401.2bab03b2.js"><link rel="prefetch" href="/assets/js/402.485f8194.js"><link rel="prefetch" href="/assets/js/403.316d7bf9.js"><link rel="prefetch" href="/assets/js/404.f4862481.js"><link rel="prefetch" href="/assets/js/405.8fda67cc.js"><link rel="prefetch" href="/assets/js/406.e94eef70.js"><link rel="prefetch" href="/assets/js/407.7c5a3ff3.js"><link rel="prefetch" href="/assets/js/408.37e46fa0.js"><link rel="prefetch" href="/assets/js/409.6e3b680e.js"><link rel="prefetch" href="/assets/js/410.f682bfa0.js"><link rel="prefetch" href="/assets/js/411.7844b996.js"><link rel="prefetch" href="/assets/js/412.e51d9f1b.js"><link rel="prefetch" href="/assets/js/413.993668cc.js"><link rel="prefetch" href="/assets/js/414.ad44d7c5.js"><link rel="prefetch" href="/assets/js/415.75d5a4a1.js"><link rel="prefetch" href="/assets/js/416.2610f9d7.js"><link rel="prefetch" href="/assets/js/417.58526bb1.js"><link rel="prefetch" href="/assets/js/418.39cccc30.js"><link rel="prefetch" href="/assets/js/419.e40ad62e.js"><link rel="prefetch" href="/assets/js/420.9f23b952.js"><link rel="prefetch" href="/assets/js/421.bf69f4d8.js"><link rel="prefetch" href="/assets/js/422.47b76cad.js"><link rel="prefetch" href="/assets/js/423.72cac98f.js"><link rel="prefetch" href="/assets/js/424.c1051eda.js"><link rel="prefetch" href="/assets/js/425.ec6d01fa.js"><link rel="prefetch" href="/assets/js/426.b60965ef.js"><link rel="prefetch" href="/assets/js/427.2d67820d.js"><link rel="prefetch" href="/assets/js/428.b6e8dad2.js"><link rel="prefetch" href="/assets/js/429.f4f58833.js"><link rel="prefetch" href="/assets/js/430.fa27f570.js"><link rel="prefetch" href="/assets/js/431.173adee5.js"><link rel="prefetch" href="/assets/js/432.4467c22c.js"><link rel="prefetch" href="/assets/js/433.bc06dc2a.js"><link rel="prefetch" href="/assets/js/434.8cc2e21c.js"><link rel="prefetch" href="/assets/js/435.c6260018.js"><link rel="prefetch" href="/assets/js/436.1aa1a53f.js"><link rel="prefetch" href="/assets/js/437.54a612bf.js"><link rel="prefetch" href="/assets/js/438.bb57f36f.js"><link rel="prefetch" href="/assets/js/439.d3ebc030.js"><link rel="prefetch" href="/assets/js/440.cbc26776.js"><link rel="prefetch" href="/assets/js/441.4ac28efb.js"><link rel="prefetch" href="/assets/js/442.9777006f.js"><link rel="prefetch" href="/assets/js/443.56ec3be3.js"><link rel="prefetch" href="/assets/js/444.299f33a0.js"><link rel="prefetch" href="/assets/js/445.fd1d36f0.js"><link rel="prefetch" href="/assets/js/446.efaf3923.js"><link rel="prefetch" href="/assets/js/447.d1879ad2.js"><link rel="prefetch" href="/assets/js/448.a2dd7c35.js"><link rel="prefetch" href="/assets/js/449.8289d899.js"><link rel="prefetch" href="/assets/js/450.68dadf2d.js"><link rel="prefetch" href="/assets/js/451.1745b59b.js"><link rel="prefetch" href="/assets/js/452.19aa0c88.js"><link rel="prefetch" href="/assets/js/453.a87d0ccd.js"><link rel="prefetch" href="/assets/js/454.908cc62f.js"><link rel="prefetch" href="/assets/js/455.356e0c4d.js"><link rel="prefetch" href="/assets/js/456.aa4f04d4.js"><link rel="prefetch" href="/assets/js/457.409c19df.js"><link rel="prefetch" href="/assets/js/458.26ff7512.js"><link rel="prefetch" href="/assets/js/459.eec44061.js"><link rel="prefetch" href="/assets/js/460.b741c5a1.js"><link rel="prefetch" href="/assets/js/461.6d7a3745.js"><link rel="prefetch" href="/assets/js/462.b8e7e4de.js"><link rel="prefetch" href="/assets/js/463.1a2bc681.js"><link rel="prefetch" href="/assets/js/464.465ca9dc.js"><link rel="prefetch" href="/assets/js/465.63bc1e1c.js"><link rel="prefetch" href="/assets/js/466.71de700a.js"><link rel="prefetch" href="/assets/js/467.5b679cc0.js"><link rel="prefetch" href="/assets/js/468.b1a2dd7d.js"><link rel="prefetch" href="/assets/js/469.08638346.js"><link rel="prefetch" href="/assets/js/470.ab28934c.js"><link rel="prefetch" href="/assets/js/471.c011d01a.js"><link rel="prefetch" href="/assets/js/472.bfa6db4d.js"><link rel="prefetch" href="/assets/js/473.16c837aa.js"><link rel="prefetch" href="/assets/js/474.f03e177a.js"><link rel="prefetch" href="/assets/js/475.a9639567.js"><link rel="prefetch" href="/assets/js/476.dd3213d6.js"><link rel="prefetch" href="/assets/js/477.a64d9cc4.js"><link rel="prefetch" href="/assets/js/478.f9aacb36.js"><link rel="prefetch" href="/assets/js/479.e2c4a3e3.js"><link rel="prefetch" href="/assets/js/480.429a6157.js"><link rel="prefetch" href="/assets/js/481.298c5479.js"><link rel="prefetch" href="/assets/js/482.8e43593a.js"><link rel="prefetch" href="/assets/js/483.74f82d03.js"><link rel="prefetch" href="/assets/js/484.0e54cdc4.js"><link rel="prefetch" href="/assets/js/485.4a873bac.js"><link rel="prefetch" href="/assets/js/486.ef55260e.js"><link rel="prefetch" href="/assets/js/487.24d24a67.js"><link rel="prefetch" href="/assets/js/488.03094b8f.js"><link rel="prefetch" href="/assets/js/489.69c92426.js"><link rel="prefetch" href="/assets/js/490.ab67421d.js"><link rel="prefetch" href="/assets/js/491.39efdc39.js"><link rel="prefetch" href="/assets/js/492.0fde0ba2.js"><link rel="prefetch" href="/assets/js/493.f2ec5ab0.js"><link rel="prefetch" href="/assets/js/494.ff533e5d.js"><link rel="prefetch" href="/assets/js/495.7db1f702.js"><link rel="prefetch" href="/assets/js/496.cd7352eb.js"><link rel="prefetch" href="/assets/js/497.55629ebd.js"><link rel="prefetch" href="/assets/js/498.de8a8407.js">
    <link rel="stylesheet" href="/assets/css/499.styles.12267a2b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      AitSchool
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">DevTools</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/DeveloperTools/software/" class="nav-link">Software</a></li><li class="dropdown-item"><!----><a href="/DeveloperTools/github/" class="nav-link">Github &amp; Git</a></li><li class="dropdown-item"><!----><a href="/DeveloperTools/homestead/" class="nav-link">Homestead</a></li></ul></div></div><div class="nav-item"><a href="/html/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/javascript/" class="nav-link">JavaScript Basics</a></li><li class="dropdown-item"><!----><a href="/html5/" class="nav-link">JavaScript Web</a></li><li class="dropdown-item"><!----><a href="/experience/" class="nav-link">JavaScript Experience</a></li><li class="dropdown-item"><!----><a href="/package/" class="nav-link">JavaScript Package</a></li><li class="dropdown-item"><!----><a href="/nodejs/" class="nav-link">JavaScript Nodejs</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ExpressDelivery</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/ExpressDelivery/html/" class="nav-link">HTML 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/css/" class="nav-link">CSS 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/js/" class="nav-link">JavaScript 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/weixin/" class="nav-link">小程序 开发</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">framework</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/framework/mvc/" class="nav-link">MVC</a></li><li class="dropdown-item"><!----><a href="/framework/vdom/" class="nav-link">VDOM</a></li><li class="dropdown-item"><!----><a href="/framework/htmlparse/" class="nav-link">ParseHTML</a></li><li class="dropdown-item"><!----><a href="/framework/reactive/" class="nav-link">Reactive</a></li><li class="dropdown-item"><!----><a href="/framework/react/" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><a href="/task/" class="nav-link">Level X</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Question</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://www.google.com/" target="_blank" rel="noopener noreferrer" class="nav-link">Google</a></li><li class="dropdown-item"><!----><a href="https://www.baidu.com/" target="_blank" rel="noopener noreferrer" class="nav-link">Baidu</a></li><li class="dropdown-item"><!----><a href="https://segmentfault.com/" target="_blank" rel="noopener noreferrer" class="nav-link">segmentfault</a></li><li class="dropdown-item"><!----><a href="https://www.docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link">文档</a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">DevTools</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/DeveloperTools/software/" class="nav-link">Software</a></li><li class="dropdown-item"><!----><a href="/DeveloperTools/github/" class="nav-link">Github &amp; Git</a></li><li class="dropdown-item"><!----><a href="/DeveloperTools/homestead/" class="nav-link">Homestead</a></li></ul></div></div><div class="nav-item"><a href="/html/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/javascript/" class="nav-link">JavaScript Basics</a></li><li class="dropdown-item"><!----><a href="/html5/" class="nav-link">JavaScript Web</a></li><li class="dropdown-item"><!----><a href="/experience/" class="nav-link">JavaScript Experience</a></li><li class="dropdown-item"><!----><a href="/package/" class="nav-link">JavaScript Package</a></li><li class="dropdown-item"><!----><a href="/nodejs/" class="nav-link">JavaScript Nodejs</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ExpressDelivery</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/ExpressDelivery/html/" class="nav-link">HTML 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/css/" class="nav-link">CSS 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/js/" class="nav-link">JavaScript 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/weixin/" class="nav-link">小程序 开发</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">framework</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/framework/mvc/" class="nav-link">MVC</a></li><li class="dropdown-item"><!----><a href="/framework/vdom/" class="nav-link">VDOM</a></li><li class="dropdown-item"><!----><a href="/framework/htmlparse/" class="nav-link">ParseHTML</a></li><li class="dropdown-item"><!----><a href="/framework/reactive/" class="nav-link">Reactive</a></li><li class="dropdown-item"><!----><a href="/framework/react/" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><a href="/task/" class="nav-link">Level X</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Question</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://www.google.com/" target="_blank" rel="noopener noreferrer" class="nav-link">Google</a></li><li class="dropdown-item"><!----><a href="https://www.baidu.com/" target="_blank" rel="noopener noreferrer" class="nav-link">Baidu</a></li><li class="dropdown-item"><!----><a href="https://segmentfault.com/" target="_blank" rel="noopener noreferrer" class="nav-link">segmentfault</a></li><li class="dropdown-item"><!----><a href="https://www.docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link">文档</a></li></ul></div></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>技术成就梦想之美</span><!----></p><ul class="sidebar-group-items"><li><a href="/" class="sidebar-link">导航</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="_7-1-活跃用户"><a href="#_7-1-活跃用户" aria-hidden="true" class="header-anchor">#</a> 7.1 活跃用户</h1><p><img src="/assets/img/7.1_1.7a632bc2.png" alt="file"></p><p>接下来我们将开发右边栏的『活跃用户』功能，此功能包括以下开发任务：</p><ul><li>定义『活跃用户』算法</li><li>编写『活跃用户』逻辑代码</li><li>新建 Artisan 命令</li><li>数据读取和展示</li><li>设定计划任务</li></ul><h2 id="_1-活跃用户算法"><a href="#_1-活跃用户算法" aria-hidden="true" class="header-anchor">#</a> 1. 活跃用户算法</h2><p>算法我们将参考 Laravel China 社区： <a href="https://laravel-china.org/topics/2902/algorithm-for-active-users" target="_blank" rel="noopener noreferrer">关于「活跃用户」的算法</a>。</p><p>系统 **每一个小时 ** 计算一次，统计 <strong>最近 7 天</strong> 所有用户发的 <strong>帖子数</strong> 和 <strong>评论数</strong>，用户每发一个帖子则得 <strong>4</strong> 分，每发一个回复得 <strong>1</strong> 分，计算出所有人的『得分』后再倒序，排名前八的用户将会显示在「活跃用户」列表里。</p><p>假设用户 A 在 7 天内发了 10 篇帖子，发了 5 条评论，则其得分为</p><pre class="language-bash"><code>10 * 4 + 5 * 1 <span class="token operator">=</span> 45 
</code></pre><h2 id="_2-编写逻辑代码"><a href="#_2-编写逻辑代码" aria-hidden="true" class="header-anchor">#</a> 2. 编写逻辑代码</h2><p>我们准备将『活跃用户』的逻辑代码放置于自定义的 Trait —— ActiveUserHelper 里，然后在 User 模型中加载此 Trait。使用 Trait 的加载方式既让相关的方法都存放于一处，便于查阅，另一方面，也保持了 User 模型的清爽。</p><p>新建此 Trait，并将算法相关的代码置于其中：</p><p><em>app/Models/Traits/ActiveUserHelper.php</em></p><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Traits</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Topic</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Reply</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Carbon<span class="token punctuation">\</span>Carbon</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">Cache</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">DB</span><span class="token punctuation">;</span>

<span class="token keyword">trait</span> <span class="token class-name">ActiveUserHelper</span>
<span class="token punctuation">{</span>
  <span class="token comment">// 用于存放临时用户数据</span>
  <span class="token keyword">protected</span> <span class="token variable">$users</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       

  <span class="token comment">// 配置信息</span>
    <span class="token keyword">protected</span> <span class="token variable">$topic_weight</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">// 话题权重</span>
    <span class="token keyword">protected</span> <span class="token variable">$reply_weight</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 回复权重</span>
    <span class="token keyword">protected</span> <span class="token variable">$pass_days</span> <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>    <span class="token comment">// 多少天内发表过内容</span>
    <span class="token keyword">protected</span> <span class="token variable">$user_number</span> <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment">// 取出来多少用户</span>

    <span class="token comment">// 缓存相关配置</span>
    <span class="token keyword">protected</span> <span class="token variable">$cache_key</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'larabbs_active_users'</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$cache_expire_in_minutes</span> <span class="token operator">=</span> <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getActiveUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 尝试从缓存中取出 cache_key 对应的数据。如果能取到，便直接返回数据。</span>
        <span class="token comment">// 否则运行匿名函数中的代码来取出活跃用户数据，返回的同时做了缓存。</span>
        <span class="token keyword">return</span> Cache<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">remember</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cache_key</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cache_expire_in_minutes</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">calculateActiveUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">calculateAndCacheActiveUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 取得活跃用户列表</span>
        <span class="token variable">$active_users</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">calculateActiveUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 并加以缓存</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">cacheActiveUsers</span><span class="token punctuation">(</span><span class="token variable">$active_users</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">calculateActiveUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">calculateTopicScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">calculateReplyScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 数组按照得分排序</span>
        <span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">array_sort</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">users</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token variable">$user</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 我们需要的是倒序，高分靠前，第二个参数为保持数组的 KEY 不变</span>
        <span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token variable">$users</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 只获取我们想要的数量</span>
        <span class="token variable">$users</span> <span class="token operator">=</span> <span class="token function">array_slice</span><span class="token punctuation">(</span><span class="token variable">$users</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_number</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 新建一个空集合</span>
        <span class="token variable">$active_users</span> <span class="token operator">=</span> <span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$users</span> <span class="token keyword">as</span> <span class="token variable">$user_id</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 找寻下是否可以找到用户</span>
            <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token variable">$user_id</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 如果数据库里有该用户的话</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment">// 将此用户实体放入集合的末尾</span>
                <span class="token variable">$active_users</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 返回数据</span>
        <span class="token keyword">return</span> <span class="token variable">$active_users</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">calculateTopicScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 从话题数据表里取出限定时间范围（$pass_days）内，有发表过话题的用户</span>
        <span class="token comment">// 并且同时取出用户此段时间内发布话题的数量</span>
        <span class="token variable">$topic_users</span> <span class="token operator">=</span> Topic<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user_id, count(*) as topic_count'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                     <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;='</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subDays</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">pass_days</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                     <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user_id'</span><span class="token punctuation">)</span>
                                     <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据话题数量计算得分</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$topic_users</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">users</span><span class="token punctuation">[</span><span class="token variable">$value</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">topic_count</span> <span class="token operator">*</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">topic_weight</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">calculateReplyScore</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 从回复数据表里取出限定时间范围（$pass_days）内，有发表过回复的用户</span>
        <span class="token comment">// 并且同时取出用户此段时间内发布回复的数量</span>
        <span class="token variable">$reply_users</span> <span class="token operator">=</span> Reply<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token constant">DB</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">raw</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user_id, count(*) as reply_count'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                     <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'created_at'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'&gt;='</span><span class="token punctuation">,</span> Carbon<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">subDays</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">pass_days</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                                     <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'user_id'</span><span class="token punctuation">)</span>
                                     <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据回复数量计算得分</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$reply_users</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token variable">$reply_score</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">reply_count</span> <span class="token operator">*</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">reply_weight</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">users</span><span class="token punctuation">[</span><span class="token variable">$value</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">users</span><span class="token punctuation">[</span><span class="token variable">$value</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'score'</span><span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token variable">$reply_score</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">users</span><span class="token punctuation">[</span><span class="token variable">$value</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">user_id</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'score'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$reply_score</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">cacheActiveUsers</span><span class="token punctuation">(</span><span class="token variable">$active_users</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 将数据放入缓存中</span>
        Cache<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cache_key</span><span class="token punctuation">,</span> <span class="token variable">$active_users</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">cache_expire_in_minutes</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><p>在 Web 项目中，我们会经常使用到缓存系统。在合理使用的情况下，缓存系统很多时候能为程序带来巨大的性能提升。Laravel 给多种缓存系统提供丰富而统一的 API，缓存配置存放于 <code>config/cache.php</code>。Laravel 支持当前流行的缓存系统，如非常棒的 Memcached 和 Redis。</p><p>在本教程中，我们将使用 Redis 作为我们的缓存驱动器。Redis 是内存缓存系统，将数据存放于内存中，读取速度飞快，是其他存储方式遥不可及的。不过因为内存大小有限，我们一般只用来存放『不经常修改，但是经常被读取』的数据。</p><p>在『活跃用户』的场景里，我们将使用计划任务，每一个小时计算一次活跃用户数据，计算成功后将数据存放于缓存中，页面展示需要此数据时，即可高速读取。</p><p>要使用 Redis 作为缓存驱动，首先需要在 <code>.env</code> 文件中将 <code>CACHE_DRIVER</code> 环境变量的值改为：</p><p><em>.env</em></p><pre class="language-bash"><code><span class="token keyword">.</span>
<span class="token keyword">.</span>
<span class="token keyword">.</span>
CACHE_DRIVER<span class="token operator">=</span>redis
<span class="token keyword">.</span>
<span class="token keyword">.</span>
<span class="token keyword">.</span>
</code></pre><p>算法的讲解，代码里有注释，这里便不再做过多讲解。下面在 User 模型中使用 Trait：</p><p><em>app/Models/User.php</em></p><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">Authenticatable</span>
<span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token package">Traits<span class="token punctuation">\</span>ActiveUserHelper</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</span></code></pre><h2 id="_3-新建-artisan-命令"><a href="#_3-新建-artisan-命令" aria-hidden="true" class="header-anchor">#</a> 3. 新建 Artisan 命令</h2><p>使用以下生成命令类：</p><pre class="language-bash"><code>$ php artisan make:command CalculateActiveUser --command<span class="token operator">=</span>larabbs:calculate-active-user
</code></pre><p>参数 <code>--command</code> 是指定 Artisan 调用的命令，一般情况下，我们推荐为命令加上命名空间，如本项目的 <code>larabbs:</code>。</p><p>打开生成的 CalculateActiveUser 命令类文件，填入以下内容：</p><p><em>app/Console/Commands/CalculateActiveUser.php</em></p><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Commands</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>Command</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CalculateActiveUser</span> <span class="token keyword">extends</span> <span class="token class-name">Command</span>
<span class="token punctuation">{</span>
    <span class="token comment">// 供我们调用命令</span>
    <span class="token keyword">protected</span> <span class="token variable">$signature</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'larabbs:calculate-active-user'</span><span class="token punctuation">;</span>

    <span class="token comment">// 命令的描述</span>
    <span class="token keyword">protected</span> <span class="token variable">$description</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'生成活跃用户'</span><span class="token punctuation">;</span>

    <span class="token comment">// 最终执行的方法</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">handle</span><span class="token punctuation">(</span>User <span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 在命令行打印一行信息</span>
        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;开始计算...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">calculateAndCacheActiveUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token double-quoted-string string">&quot;成功生成！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><p>此刻使用 <code>php artisan list</code> 即可看到我们的命令行：</p><p><img src="/assets/img/7.1_2.f5392f7d.png" alt="file"></p><p>执行此命令生成『活跃用户』数据：</p><pre class="language-bash"><code>$ php artisan larabbs:calculate-active-user
</code></pre><p>修改下 TopicsController 中的 <code>index()</code> 方法，我们尝试打印从缓存里读取出来的数据：</p><p><em>app/Http/Controllers/TopicsController.php</em></p><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TopicsController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span>Request <span class="token variable">$request</span><span class="token punctuation">,</span> Topic <span class="token variable">$topic</span><span class="token punctuation">,</span> User <span class="token variable">$user</span><span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token variable">$topics</span> <span class="token operator">=</span> <span class="token variable">$topic</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withOrder</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$active_users</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getActiveUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">dd</span><span class="token punctuation">(</span><span class="token variable">$active_users</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'topics.index'</span><span class="token punctuation">,</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'topics'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'active_users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</span></code></pre><p>首先顶部导入 User 类，并作为 <code>index()</code> 的第三个参数传参，这里这是只是一个便捷的 <code>$user = new User</code> 写法而已。</p><p>访问话题列表页面，即可看到我们的『活跃用户』集合：</p><p><img src="/assets/img/7.1_3.5672928a.png" alt="file"></p><p>测试完成后请将 <code>dd($active_users);</code> 删除。</p><h2 id="_4-页面展示"><a href="#_4-页面展示" aria-hidden="true" class="header-anchor">#</a> 4. 页面展示</h2><p>我们已经可以读取到数据，接下来我们在左边栏中把数据显示出来。</p><p>修改右边栏模板，替换为以下：</p><p><em>resources/views/topics/_sidebar.blade.php</em></p><pre class="language-php"><code><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;panel panel-default&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;panel-body&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token double-quoted-string string">&quot;{{ route('topics.create') }}&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;btn btn-success btn-block&quot;</span> aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token double-quoted-string string">&quot;Left Align&quot;</span><span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;glyphicon glyphicon-pencil&quot;</span> aria<span class="token operator">-</span>hidden<span class="token operator">=</span><span class="token double-quoted-string string">&quot;true&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span> 新建帖子
        <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

@<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$active_users</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;panel panel-default&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;panel-body active-users&quot;</span><span class="token operator">&gt;</span>

            <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;text-center&quot;</span><span class="token operator">&gt;</span>活跃用户<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
            <span class="token operator">&lt;</span>hr<span class="token operator">&gt;</span>
            @<span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$active_users</span> <span class="token keyword">as</span> <span class="token variable">$active_user</span><span class="token punctuation">)</span>
                <span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;media&quot;</span> href<span class="token operator">=</span><span class="token double-quoted-string string">&quot;{{ route('users.show', <span class="token interpolation"><span class="token variable">$active_user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span></span>) }}&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;media-left media-middle&quot;</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token double-quoted-string string">&quot;{{ <span class="token interpolation"><span class="token variable">$active_user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">avatar</span></span> }}&quot;</span> width<span class="token operator">=</span><span class="token double-quoted-string string">&quot;24px&quot;</span> height<span class="token operator">=</span><span class="token double-quoted-string string">&quot;24px&quot;</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;img-circle media-object&quot;</span><span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

                    <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;media-body&quot;</span><span class="token operator">&gt;</span>
                        <span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token double-quoted-string string">&quot;media-heading&quot;</span><span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> <span class="token variable">$active_user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
                    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
            @<span class="token keyword">endforeach</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
@<span class="token keyword">endif</span>
</code></pre><p>刷新页面即可看到我们的活跃用户区块：</p><p><img src="/assets/img/7.1_4.4f28a34d.png" alt="file"></p><p>优化下样式：</p><p><em>resources/assets/sass/app.scss</em></p><pre class="language-css"><code>.
.
.

<span class="token comment">/* Sidebar */</span>

<span class="token selector">.sidebar</span> <span class="token punctuation">{</span>
    <span class="token selector">.panel-body</span> <span class="token punctuation">{</span>
        <span class="token property">padding</span><span class="token punctuation">:</span> 12px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">hr</span> <span class="token punctuation">{</span>
        <span class="token property">margin-top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
        <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token selector">.active-users</span> <span class="token punctuation">{</span>
        <span class="token selector">a.media</span> <span class="token punctuation">{</span>
            <span class="token property">color</span><span class="token punctuation">:</span> #797878<span class="token punctuation">;</span>
            <span class="token property">line-height</span><span class="token punctuation">:</span> 26px<span class="token punctuation">;</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> 0.9em<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><p>编译完成后，再次刷新页面：</p><p><img src="/assets/img/7.1_5.6448e55a.png" alt="file"></p><h2 id="_5-计划任务"><a href="#_5-计划任务" aria-hidden="true" class="header-anchor">#</a> 5. 计划任务</h2><p>在过去，开发者必须为每个需要调度的任务生成单独的 Cron 项目。然而令人头疼的是任务调度不受版本控制，并且需要 SSH 到服务器上来增加 Cron 条目。</p><p>Laravel 命令调度器允许你在 Laravel 中对命令调度进行清晰流畅的定义，并且仅需要在服务器上增加一条 Cron 项目即可。调度在在 <code>app/Console/Kernel.php</code> 文件的 <code>schedule</code> 方法中定义。在该方法内包含了一个简单的例子，你可以随意增加调度到 Schedule 对象中。</p><p>使用调度器时，我们需要修改系统的 Cron 计划任务配置信息，运行以下命令：</p><pre class="language-bash"><code>$ <span class="token function">export</span> EDITOR<span class="token operator">=</span>vi <span class="token operator">&amp;&amp;</span> <span class="token function">crontab</span> -e
</code></pre><p>复制下面这一行：</p><pre class="language-bash"><code>* * * * * php /home/vagrant/Code/larabbs/artisan schedule:run <span class="token operator">&gt;&gt;</span> /dev/null 2<span class="token operator">&gt;</span><span class="token operator">&amp;</span>1
</code></pre><p>此时进入 VI 编辑器界面：</p><ol><li>使用键盘上的方向键将光标移动到最底端；</li><li>然后按键盘上的 『小写 o 键』进入 INSERT 模式；</li><li>黏贴上面这一行；</li><li>黏贴成功后按下键盘左上角的『ESC 键』进入 VI 的命令模式；</li><li>键盘输入 <code>:wq</code> 并敲击回车键保存退出。</li></ol><p>整个操作过程的动图如下：</p><p><img src="/assets/img/7.1_6.4bb7fde6.gif" alt="file"></p><p>系统的 Cron 已经设定好了，现在 Cron 软件将会每分钟调用一次 Laravel 命令调度器，当 <code>schedule:run</code> 命令执行时， Laravel 会评估你的计划任务并运行预定任务。</p><p>接下来将我们注册调度任务即可：</p><p><em>app/Console/Kernel.php</em></p><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token keyword">class</span> <span class="token class-name">Kernel</span> <span class="token keyword">extends</span> <span class="token class-name">ConsoleKernel</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span>
    <span class="token keyword">protected</span> <span class="token keyword">function</span> <span class="token function">schedule</span><span class="token punctuation">(</span>Schedule <span class="token variable">$schedule</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// $schedule-&gt;command('inspire')</span>
        <span class="token comment">//          -&gt;hourly();</span>
        <span class="token comment">// 一小时执行一次『活跃用户』数据生成的命令</span>
        <span class="token variable">$schedule</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">command</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'larabbs:calculate-active-user'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">hourly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span>
    <span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</span></code></pre><h2 id="_6-缓存效果示例"><a href="#_6-缓存效果示例" aria-hidden="true" class="header-anchor">#</a> 6. 缓存效果示例</h2><p>清空我们的缓存：</p><pre class="language-bash"><code>$ php artisan cache:clear
</code></pre><p>调出 Laravel 开发者工具类查看页面 SQL 请求数，可以看到没有缓存时，页面需要请求 13 条 SQL ，有了缓存只需要 5 条：</p><p><img src="/assets/img/7.1_7.8685d8f8.gif" alt="file"></p><h2 id="_7-分类话题列表"><a href="#_7-分类话题列表" aria-hidden="true" class="header-anchor">#</a> 7. 分类话题列表</h2><p>我们的分类话题列表页使用侧边栏，我们需要在分类控制器中将『活跃用户』数据传入模板中：</p><p><em>app/Http/Controllers/CategoriesController.php</em></p><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token keyword">use</span> <span class="token package">App<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>User</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">CategoriesController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span>Category <span class="token variable">$category</span><span class="token punctuation">,</span> Request <span class="token variable">$request</span><span class="token punctuation">,</span> Topic <span class="token variable">$topic</span><span class="token punctuation">,</span> User <span class="token variable">$user</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// 读取分类 ID 关联的话题，并按每 20 条分页</span>
        <span class="token variable">$topics</span> <span class="token operator">=</span> <span class="token variable">$topic</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">withOrder</span><span class="token punctuation">(</span><span class="token variable">$request</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">order</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'category_id'</span><span class="token punctuation">,</span> <span class="token variable">$category</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">)</span>
                        <span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">paginate</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 活跃用户列表</span>
        <span class="token variable">$active_users</span> <span class="token operator">=</span> <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getActiveUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 传参变量话题和分类到模板中</span>
        <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'topics.index'</span><span class="token punctuation">,</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'topics'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'category'</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'active_users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre><p>注意类文件顶部 User 模型类的引入。现在访问话题分类页面：</p><p><img src="/assets/img/7.1_8.79d772c4.png" alt="file"></p><h2 id="git-版本控制"><a href="#git-版本控制" aria-hidden="true" class="header-anchor">#</a> Git 版本控制</h2><p>下面把代码纳入到版本管理：</p><pre class="language-bash"><code>$ <span class="token function">git</span> add -A
$ <span class="token function">git</span> commit -m <span class="token string">&quot;Sidebar active users&quot;</span>
</code></pre></div><!----><!----></div></div></div>
    <script src="/assets/js/298.ce80c048.js" defer></script><script src="/assets/js/app.8c64503a.js" defer></script>
  </body>
</html>
