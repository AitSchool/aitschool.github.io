<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AitSchool | 3.3 小程序登录页面</title>
    <meta name="description" content="技术成就梦想之美">
    <link rel="icon" href="/logo.png">
    
    <link rel="preload" href="/assets/css/499.styles.12267a2b.css" as="style"><link rel="preload" href="/assets/js/app.8c64503a.js" as="script"><link rel="preload" href="/assets/js/222.1d132cf7.js" as="script"><link rel="prefetch" href="/assets/js/0.88fc2358.js"><link rel="prefetch" href="/assets/js/1.60ca915f.js"><link rel="prefetch" href="/assets/js/2.b0d4ec39.js"><link rel="prefetch" href="/assets/js/3.9d9b72af.js"><link rel="prefetch" href="/assets/js/4.192f8085.js"><link rel="prefetch" href="/assets/js/5.4177efbc.js"><link rel="prefetch" href="/assets/js/6.d131d89b.js"><link rel="prefetch" href="/assets/js/7.248b3640.js"><link rel="prefetch" href="/assets/js/8.43bfce3c.js"><link rel="prefetch" href="/assets/js/9.cce4d19c.js"><link rel="prefetch" href="/assets/js/10.22fc6bb9.js"><link rel="prefetch" href="/assets/js/11.3b29fb7c.js"><link rel="prefetch" href="/assets/js/12.7645ad71.js"><link rel="prefetch" href="/assets/js/13.7e63c29c.js"><link rel="prefetch" href="/assets/js/14.c2cd801f.js"><link rel="prefetch" href="/assets/js/15.eb95c8f8.js"><link rel="prefetch" href="/assets/js/16.53e478e9.js"><link rel="prefetch" href="/assets/js/17.8a1ca77e.js"><link rel="prefetch" href="/assets/js/18.b5aa5efe.js"><link rel="prefetch" href="/assets/js/19.a2534c9e.js"><link rel="prefetch" href="/assets/js/20.41856387.js"><link rel="prefetch" href="/assets/js/21.f9e91174.js"><link rel="prefetch" href="/assets/js/22.faa8311c.js"><link rel="prefetch" href="/assets/js/23.fa235125.js"><link rel="prefetch" href="/assets/js/24.b8f1192a.js"><link rel="prefetch" href="/assets/js/25.b02b5515.js"><link rel="prefetch" href="/assets/js/26.8679f6fa.js"><link rel="prefetch" href="/assets/js/27.8331b4a0.js"><link rel="prefetch" href="/assets/js/28.33246a42.js"><link rel="prefetch" href="/assets/js/29.ac28a69f.js"><link rel="prefetch" href="/assets/js/30.ce225449.js"><link rel="prefetch" href="/assets/js/31.2ae097e3.js"><link rel="prefetch" href="/assets/js/32.4399601b.js"><link rel="prefetch" href="/assets/js/33.0b43ea1a.js"><link rel="prefetch" href="/assets/js/34.a9ee1c3d.js"><link rel="prefetch" href="/assets/js/35.f21f37ee.js"><link rel="prefetch" href="/assets/js/36.67c71226.js"><link rel="prefetch" href="/assets/js/37.9d4e2758.js"><link rel="prefetch" href="/assets/js/38.14baf3cf.js"><link rel="prefetch" href="/assets/js/39.7dbe6512.js"><link rel="prefetch" href="/assets/js/40.580423a8.js"><link rel="prefetch" href="/assets/js/41.f87a2e09.js"><link rel="prefetch" href="/assets/js/42.764d1536.js"><link rel="prefetch" href="/assets/js/43.ac78d321.js"><link rel="prefetch" href="/assets/js/44.da0c3404.js"><link rel="prefetch" href="/assets/js/45.6a83afb6.js"><link rel="prefetch" href="/assets/js/46.d94ec96b.js"><link rel="prefetch" href="/assets/js/47.6d323cac.js"><link rel="prefetch" href="/assets/js/48.ade54b3f.js"><link rel="prefetch" href="/assets/js/49.9f406e20.js"><link rel="prefetch" href="/assets/js/50.2124e59e.js"><link rel="prefetch" href="/assets/js/51.068f6682.js"><link rel="prefetch" href="/assets/js/52.c2d45965.js"><link rel="prefetch" href="/assets/js/53.8016ed73.js"><link rel="prefetch" href="/assets/js/54.72bc2e46.js"><link rel="prefetch" href="/assets/js/55.89a8c7eb.js"><link rel="prefetch" href="/assets/js/56.4c0c6535.js"><link rel="prefetch" href="/assets/js/57.06001e23.js"><link rel="prefetch" href="/assets/js/58.b4ee5a98.js"><link rel="prefetch" href="/assets/js/59.199a5d47.js"><link rel="prefetch" href="/assets/js/60.72a07853.js"><link rel="prefetch" href="/assets/js/61.3e1c9b91.js"><link rel="prefetch" href="/assets/js/62.bf1a9136.js"><link rel="prefetch" href="/assets/js/63.31e3df80.js"><link rel="prefetch" href="/assets/js/64.8d68a2c8.js"><link rel="prefetch" href="/assets/js/65.4c3acddf.js"><link rel="prefetch" href="/assets/js/66.9dffdf18.js"><link rel="prefetch" href="/assets/js/67.6c5f9c89.js"><link rel="prefetch" href="/assets/js/68.165b7f48.js"><link rel="prefetch" href="/assets/js/69.07f9edea.js"><link rel="prefetch" href="/assets/js/70.9f320639.js"><link rel="prefetch" href="/assets/js/71.c706adb0.js"><link rel="prefetch" href="/assets/js/72.c7c1584f.js"><link rel="prefetch" href="/assets/js/73.cb9f9414.js"><link rel="prefetch" href="/assets/js/74.65f6fab6.js"><link rel="prefetch" href="/assets/js/75.16f3c601.js"><link rel="prefetch" href="/assets/js/76.0af64646.js"><link rel="prefetch" href="/assets/js/77.36b6a13b.js"><link rel="prefetch" href="/assets/js/78.12be2b67.js"><link rel="prefetch" href="/assets/js/79.35085fe7.js"><link rel="prefetch" href="/assets/js/80.e5058d97.js"><link rel="prefetch" href="/assets/js/81.2831af92.js"><link rel="prefetch" href="/assets/js/82.6a8936f9.js"><link rel="prefetch" href="/assets/js/83.4ab55c15.js"><link rel="prefetch" href="/assets/js/84.ecd46aba.js"><link rel="prefetch" href="/assets/js/85.2129c567.js"><link rel="prefetch" href="/assets/js/86.e0a970f3.js"><link rel="prefetch" href="/assets/js/87.1f4dab74.js"><link rel="prefetch" href="/assets/js/88.b0f99ad1.js"><link rel="prefetch" href="/assets/js/89.bebb4957.js"><link rel="prefetch" href="/assets/js/90.b950a353.js"><link rel="prefetch" href="/assets/js/91.00a43224.js"><link rel="prefetch" href="/assets/js/92.4a526a02.js"><link rel="prefetch" href="/assets/js/93.ef7c81a7.js"><link rel="prefetch" href="/assets/js/94.b725689c.js"><link rel="prefetch" href="/assets/js/95.de02bc77.js"><link rel="prefetch" href="/assets/js/96.76a60666.js"><link rel="prefetch" href="/assets/js/97.238c8a57.js"><link rel="prefetch" href="/assets/js/98.7a34b22e.js"><link rel="prefetch" href="/assets/js/99.9075800a.js"><link rel="prefetch" href="/assets/js/100.f7bbc859.js"><link rel="prefetch" href="/assets/js/101.d98502e1.js"><link rel="prefetch" href="/assets/js/102.f1adc4e0.js"><link rel="prefetch" href="/assets/js/103.17fea761.js"><link rel="prefetch" href="/assets/js/104.7a0c5d9a.js"><link rel="prefetch" href="/assets/js/105.0cb6f672.js"><link rel="prefetch" href="/assets/js/106.a7fa93a4.js"><link rel="prefetch" href="/assets/js/107.1b0da725.js"><link rel="prefetch" href="/assets/js/108.e1fa6f46.js"><link rel="prefetch" href="/assets/js/109.3b56d9b0.js"><link rel="prefetch" href="/assets/js/110.0158017c.js"><link rel="prefetch" href="/assets/js/111.2be2ae13.js"><link rel="prefetch" href="/assets/js/112.6801de53.js"><link rel="prefetch" href="/assets/js/113.5cdc3601.js"><link rel="prefetch" href="/assets/js/114.38df81f6.js"><link rel="prefetch" href="/assets/js/115.8b16b4be.js"><link rel="prefetch" href="/assets/js/116.87be9072.js"><link rel="prefetch" href="/assets/js/117.5e8577ac.js"><link rel="prefetch" href="/assets/js/118.8d9094a0.js"><link rel="prefetch" href="/assets/js/119.53dc2da4.js"><link rel="prefetch" href="/assets/js/120.1e04a362.js"><link rel="prefetch" href="/assets/js/121.130dfac5.js"><link rel="prefetch" href="/assets/js/122.2bcd0629.js"><link rel="prefetch" href="/assets/js/123.ed404964.js"><link rel="prefetch" href="/assets/js/124.fd1908cd.js"><link rel="prefetch" href="/assets/js/125.f45f6642.js"><link rel="prefetch" href="/assets/js/126.32c49e09.js"><link rel="prefetch" href="/assets/js/127.197bd5cc.js"><link rel="prefetch" href="/assets/js/128.0ca85dc2.js"><link rel="prefetch" href="/assets/js/129.9ddd421d.js"><link rel="prefetch" href="/assets/js/130.ef14be6d.js"><link rel="prefetch" href="/assets/js/131.c2676466.js"><link rel="prefetch" href="/assets/js/132.e3a23826.js"><link rel="prefetch" href="/assets/js/133.62f980ee.js"><link rel="prefetch" href="/assets/js/134.fb7bc409.js"><link rel="prefetch" href="/assets/js/135.d5985ff7.js"><link rel="prefetch" href="/assets/js/136.02a567fa.js"><link rel="prefetch" href="/assets/js/137.d955038c.js"><link rel="prefetch" href="/assets/js/138.1f4fcd27.js"><link rel="prefetch" href="/assets/js/139.8b5629d8.js"><link rel="prefetch" href="/assets/js/140.bcae2acf.js"><link rel="prefetch" href="/assets/js/141.8371382f.js"><link rel="prefetch" href="/assets/js/142.3d456486.js"><link rel="prefetch" href="/assets/js/143.1bdfb337.js"><link rel="prefetch" href="/assets/js/144.71fffaf3.js"><link rel="prefetch" href="/assets/js/145.c0bbf668.js"><link rel="prefetch" href="/assets/js/146.2f856c68.js"><link rel="prefetch" href="/assets/js/147.24560fba.js"><link rel="prefetch" href="/assets/js/148.a059a88c.js"><link rel="prefetch" href="/assets/js/149.bedada4a.js"><link rel="prefetch" href="/assets/js/150.42a282c3.js"><link rel="prefetch" href="/assets/js/151.e059deb5.js"><link rel="prefetch" href="/assets/js/152.25f873d8.js"><link rel="prefetch" href="/assets/js/153.12ca2f78.js"><link rel="prefetch" href="/assets/js/154.47db605c.js"><link rel="prefetch" href="/assets/js/155.b43f642e.js"><link rel="prefetch" href="/assets/js/156.6cd1bafc.js"><link rel="prefetch" href="/assets/js/157.14c5db2a.js"><link rel="prefetch" href="/assets/js/158.22846353.js"><link rel="prefetch" href="/assets/js/159.2b12dd54.js"><link rel="prefetch" href="/assets/js/160.0fe5fb12.js"><link rel="prefetch" href="/assets/js/161.e94d2b77.js"><link rel="prefetch" href="/assets/js/162.9c023f47.js"><link rel="prefetch" href="/assets/js/163.da3e83dc.js"><link rel="prefetch" href="/assets/js/164.f8775a6b.js"><link rel="prefetch" href="/assets/js/165.dfd47d19.js"><link rel="prefetch" href="/assets/js/166.8bf5a1d4.js"><link rel="prefetch" href="/assets/js/167.dd42a3fa.js"><link rel="prefetch" href="/assets/js/168.5e0d1f5a.js"><link rel="prefetch" href="/assets/js/169.252337e4.js"><link rel="prefetch" href="/assets/js/170.717d70a6.js"><link rel="prefetch" href="/assets/js/171.d4ef0b55.js"><link rel="prefetch" href="/assets/js/172.e5295d2c.js"><link rel="prefetch" href="/assets/js/173.eb6182bf.js"><link rel="prefetch" href="/assets/js/174.9d0ca9f9.js"><link rel="prefetch" href="/assets/js/175.d18e876f.js"><link rel="prefetch" href="/assets/js/176.83b41082.js"><link rel="prefetch" href="/assets/js/177.c0a501b8.js"><link rel="prefetch" href="/assets/js/178.cda9b7cd.js"><link rel="prefetch" href="/assets/js/179.9d157169.js"><link rel="prefetch" href="/assets/js/180.a1fbf4ad.js"><link rel="prefetch" href="/assets/js/181.e581ceb3.js"><link rel="prefetch" href="/assets/js/182.2f343c73.js"><link rel="prefetch" href="/assets/js/183.2fd6ed7b.js"><link rel="prefetch" href="/assets/js/184.99e01cf2.js"><link rel="prefetch" href="/assets/js/185.7e184a86.js"><link rel="prefetch" href="/assets/js/186.a00ec23d.js"><link rel="prefetch" href="/assets/js/187.c2bcda0f.js"><link rel="prefetch" href="/assets/js/188.e612162a.js"><link rel="prefetch" href="/assets/js/189.9cd66396.js"><link rel="prefetch" href="/assets/js/190.a024b8b2.js"><link rel="prefetch" href="/assets/js/191.18b08639.js"><link rel="prefetch" href="/assets/js/192.322ab1c4.js"><link rel="prefetch" href="/assets/js/193.40b46ecc.js"><link rel="prefetch" href="/assets/js/194.32833e3a.js"><link rel="prefetch" href="/assets/js/195.2eca5344.js"><link rel="prefetch" href="/assets/js/196.dde12043.js"><link rel="prefetch" href="/assets/js/197.6dc3cd61.js"><link rel="prefetch" href="/assets/js/198.3f289008.js"><link rel="prefetch" href="/assets/js/199.969a9e38.js"><link rel="prefetch" href="/assets/js/200.de8f0077.js"><link rel="prefetch" href="/assets/js/201.e6995ba5.js"><link rel="prefetch" href="/assets/js/202.f876c05d.js"><link rel="prefetch" href="/assets/js/203.7e1b4ad4.js"><link rel="prefetch" href="/assets/js/204.8c10989c.js"><link rel="prefetch" href="/assets/js/205.5ad782b9.js"><link rel="prefetch" href="/assets/js/206.8975ab1f.js"><link rel="prefetch" href="/assets/js/207.d7d29ca1.js"><link rel="prefetch" href="/assets/js/208.e5dcd397.js"><link rel="prefetch" href="/assets/js/209.d12da347.js"><link rel="prefetch" href="/assets/js/210.218a96c7.js"><link rel="prefetch" href="/assets/js/211.0155de67.js"><link rel="prefetch" href="/assets/js/212.f9dc9a3b.js"><link rel="prefetch" href="/assets/js/213.bf90f9ee.js"><link rel="prefetch" href="/assets/js/214.968ecd66.js"><link rel="prefetch" href="/assets/js/215.befe282f.js"><link rel="prefetch" href="/assets/js/216.e9f5a499.js"><link rel="prefetch" href="/assets/js/217.1b8dad47.js"><link rel="prefetch" href="/assets/js/218.d939e092.js"><link rel="prefetch" href="/assets/js/219.ae142e9f.js"><link rel="prefetch" href="/assets/js/220.a06315e2.js"><link rel="prefetch" href="/assets/js/221.8a7c03bf.js"><link rel="prefetch" href="/assets/js/223.a3b76fce.js"><link rel="prefetch" href="/assets/js/224.033a0702.js"><link rel="prefetch" href="/assets/js/225.63b54587.js"><link rel="prefetch" href="/assets/js/226.665adb15.js"><link rel="prefetch" href="/assets/js/227.15bf10f7.js"><link rel="prefetch" href="/assets/js/228.d4e1b79b.js"><link rel="prefetch" href="/assets/js/229.0303e4b9.js"><link rel="prefetch" href="/assets/js/230.c44133e1.js"><link rel="prefetch" href="/assets/js/231.3a6cafee.js"><link rel="prefetch" href="/assets/js/232.f96430c8.js"><link rel="prefetch" href="/assets/js/233.1fe08012.js"><link rel="prefetch" href="/assets/js/234.7b07da1f.js"><link rel="prefetch" href="/assets/js/235.28169098.js"><link rel="prefetch" href="/assets/js/236.91cf4cf6.js"><link rel="prefetch" href="/assets/js/237.b5c0e89e.js"><link rel="prefetch" href="/assets/js/238.59b8e17d.js"><link rel="prefetch" href="/assets/js/239.7116e744.js"><link rel="prefetch" href="/assets/js/240.58439792.js"><link rel="prefetch" href="/assets/js/241.3ca215e8.js"><link rel="prefetch" href="/assets/js/242.79a0970a.js"><link rel="prefetch" href="/assets/js/243.6c104851.js"><link rel="prefetch" href="/assets/js/244.94af4ca6.js"><link rel="prefetch" href="/assets/js/245.258f69cc.js"><link rel="prefetch" href="/assets/js/246.cdbadb70.js"><link rel="prefetch" href="/assets/js/247.bfb09ad3.js"><link rel="prefetch" href="/assets/js/248.cdf3f595.js"><link rel="prefetch" href="/assets/js/249.c79af26b.js"><link rel="prefetch" href="/assets/js/250.32edff71.js"><link rel="prefetch" href="/assets/js/251.5f900e99.js"><link rel="prefetch" href="/assets/js/252.6c1b3c6c.js"><link rel="prefetch" href="/assets/js/253.5427022f.js"><link rel="prefetch" href="/assets/js/254.99161875.js"><link rel="prefetch" href="/assets/js/255.48f9597e.js"><link rel="prefetch" href="/assets/js/256.9255fe08.js"><link rel="prefetch" href="/assets/js/257.fe7a7386.js"><link rel="prefetch" href="/assets/js/258.f7129b51.js"><link rel="prefetch" href="/assets/js/259.826f9688.js"><link rel="prefetch" href="/assets/js/260.75ab7e50.js"><link rel="prefetch" href="/assets/js/261.8f3e35a0.js"><link rel="prefetch" href="/assets/js/262.5f282380.js"><link rel="prefetch" href="/assets/js/263.32c6f479.js"><link rel="prefetch" href="/assets/js/264.e4199b4f.js"><link rel="prefetch" href="/assets/js/265.f89dea38.js"><link rel="prefetch" href="/assets/js/266.755be615.js"><link rel="prefetch" href="/assets/js/267.0e7b7e8d.js"><link rel="prefetch" href="/assets/js/268.7d990e3d.js"><link rel="prefetch" href="/assets/js/269.6e997320.js"><link rel="prefetch" href="/assets/js/270.7e342e55.js"><link rel="prefetch" href="/assets/js/271.fd73a77f.js"><link rel="prefetch" href="/assets/js/272.3840ce7a.js"><link rel="prefetch" href="/assets/js/273.8dd421cd.js"><link rel="prefetch" href="/assets/js/274.a07d192f.js"><link rel="prefetch" href="/assets/js/275.356834cb.js"><link rel="prefetch" href="/assets/js/276.fce52094.js"><link rel="prefetch" href="/assets/js/277.9993b976.js"><link rel="prefetch" href="/assets/js/278.a5e04ae4.js"><link rel="prefetch" href="/assets/js/279.bf070787.js"><link rel="prefetch" href="/assets/js/280.07e99bfc.js"><link rel="prefetch" href="/assets/js/281.52acbada.js"><link rel="prefetch" href="/assets/js/282.2ed92736.js"><link rel="prefetch" href="/assets/js/283.54434353.js"><link rel="prefetch" href="/assets/js/284.a6ca871d.js"><link rel="prefetch" href="/assets/js/285.975a84a4.js"><link rel="prefetch" href="/assets/js/286.82cbd5cd.js"><link rel="prefetch" href="/assets/js/287.82f522cb.js"><link rel="prefetch" href="/assets/js/288.9be96617.js"><link rel="prefetch" href="/assets/js/289.a93c1290.js"><link rel="prefetch" href="/assets/js/290.2c69c8a5.js"><link rel="prefetch" href="/assets/js/291.4b3f647d.js"><link rel="prefetch" href="/assets/js/292.fd4ef2dd.js"><link rel="prefetch" href="/assets/js/293.a33d7820.js"><link rel="prefetch" href="/assets/js/294.7139d6c5.js"><link rel="prefetch" href="/assets/js/295.421420a6.js"><link rel="prefetch" href="/assets/js/296.9c3231d6.js"><link rel="prefetch" href="/assets/js/297.ab34deee.js"><link rel="prefetch" href="/assets/js/298.ce80c048.js"><link rel="prefetch" href="/assets/js/299.0264dad7.js"><link rel="prefetch" href="/assets/js/300.61a5328f.js"><link rel="prefetch" href="/assets/js/301.95025cfe.js"><link rel="prefetch" href="/assets/js/302.bea4d770.js"><link rel="prefetch" href="/assets/js/303.93b18e45.js"><link rel="prefetch" href="/assets/js/304.c1769477.js"><link rel="prefetch" href="/assets/js/305.78d9c4f9.js"><link rel="prefetch" href="/assets/js/306.eca23cfe.js"><link rel="prefetch" href="/assets/js/307.bd1933ca.js"><link rel="prefetch" href="/assets/js/308.90037466.js"><link rel="prefetch" href="/assets/js/309.da7dfa7e.js"><link rel="prefetch" href="/assets/js/310.a87fd635.js"><link rel="prefetch" href="/assets/js/311.a4b693f7.js"><link rel="prefetch" href="/assets/js/312.d42aa095.js"><link rel="prefetch" href="/assets/js/313.101dae88.js"><link rel="prefetch" href="/assets/js/314.8ab7a51d.js"><link rel="prefetch" href="/assets/js/315.79c0fa39.js"><link rel="prefetch" href="/assets/js/316.3fa37331.js"><link rel="prefetch" href="/assets/js/317.350c7571.js"><link rel="prefetch" href="/assets/js/318.4cd2a8c9.js"><link rel="prefetch" href="/assets/js/319.ba360f0d.js"><link rel="prefetch" href="/assets/js/320.9f12fd41.js"><link rel="prefetch" href="/assets/js/321.4b8bf74b.js"><link rel="prefetch" href="/assets/js/322.94257572.js"><link rel="prefetch" href="/assets/js/323.8d274f3a.js"><link rel="prefetch" href="/assets/js/324.e948d936.js"><link rel="prefetch" href="/assets/js/325.2f070cc7.js"><link rel="prefetch" href="/assets/js/326.02f51272.js"><link rel="prefetch" href="/assets/js/327.213e52c7.js"><link rel="prefetch" href="/assets/js/328.148b3b03.js"><link rel="prefetch" href="/assets/js/329.61608755.js"><link rel="prefetch" href="/assets/js/330.fec7d9df.js"><link rel="prefetch" href="/assets/js/331.bee9c11d.js"><link rel="prefetch" href="/assets/js/332.669c33a2.js"><link rel="prefetch" href="/assets/js/333.39399bc6.js"><link rel="prefetch" href="/assets/js/334.6b5bc719.js"><link rel="prefetch" href="/assets/js/335.46d5e60e.js"><link rel="prefetch" href="/assets/js/336.9716f6a6.js"><link rel="prefetch" href="/assets/js/337.2fdb9aaf.js"><link rel="prefetch" href="/assets/js/338.527fd99c.js"><link rel="prefetch" href="/assets/js/339.aa8226bf.js"><link rel="prefetch" href="/assets/js/340.bbbcc246.js"><link rel="prefetch" href="/assets/js/341.ac4e7106.js"><link rel="prefetch" href="/assets/js/342.616d0132.js"><link rel="prefetch" href="/assets/js/343.4f0aa045.js"><link rel="prefetch" href="/assets/js/344.7fa2a130.js"><link rel="prefetch" href="/assets/js/345.c039cf15.js"><link rel="prefetch" href="/assets/js/346.2483de0a.js"><link rel="prefetch" href="/assets/js/347.21290793.js"><link rel="prefetch" href="/assets/js/348.4e5a4ac9.js"><link rel="prefetch" href="/assets/js/349.bc39723a.js"><link rel="prefetch" href="/assets/js/350.4994e747.js"><link rel="prefetch" href="/assets/js/351.6b1897d7.js"><link rel="prefetch" href="/assets/js/352.7e2ada88.js"><link rel="prefetch" href="/assets/js/353.1ced2397.js"><link rel="prefetch" href="/assets/js/354.28b9da77.js"><link rel="prefetch" href="/assets/js/355.29942184.js"><link rel="prefetch" href="/assets/js/356.c5ec1df4.js"><link rel="prefetch" href="/assets/js/357.a2b042c4.js"><link rel="prefetch" href="/assets/js/358.f7c81f82.js"><link rel="prefetch" href="/assets/js/359.fd859e36.js"><link rel="prefetch" href="/assets/js/360.ec3561bc.js"><link rel="prefetch" href="/assets/js/361.f41fe199.js"><link rel="prefetch" href="/assets/js/362.69c70c99.js"><link rel="prefetch" href="/assets/js/363.1702181a.js"><link rel="prefetch" href="/assets/js/364.824dfd6b.js"><link rel="prefetch" href="/assets/js/365.1eeb4973.js"><link rel="prefetch" href="/assets/js/366.a926d040.js"><link rel="prefetch" href="/assets/js/367.6f5c3eda.js"><link rel="prefetch" href="/assets/js/368.4fb65e1c.js"><link rel="prefetch" href="/assets/js/369.d96964eb.js"><link rel="prefetch" href="/assets/js/370.492f3b09.js"><link rel="prefetch" href="/assets/js/371.aa401467.js"><link rel="prefetch" href="/assets/js/372.4e7d3e4a.js"><link rel="prefetch" href="/assets/js/373.ed6d1b15.js"><link rel="prefetch" href="/assets/js/374.de74b2e6.js"><link rel="prefetch" href="/assets/js/375.d4102228.js"><link rel="prefetch" href="/assets/js/376.b7a1585f.js"><link rel="prefetch" href="/assets/js/377.cfc390f5.js"><link rel="prefetch" href="/assets/js/378.1184d756.js"><link rel="prefetch" href="/assets/js/379.a6411f61.js"><link rel="prefetch" href="/assets/js/380.741bfb4b.js"><link rel="prefetch" href="/assets/js/381.193060a0.js"><link rel="prefetch" href="/assets/js/382.21556693.js"><link rel="prefetch" href="/assets/js/383.a820e5fc.js"><link rel="prefetch" href="/assets/js/384.93f69ee9.js"><link rel="prefetch" href="/assets/js/385.b3c6a465.js"><link rel="prefetch" href="/assets/js/386.14a37e8a.js"><link rel="prefetch" href="/assets/js/387.91f832fa.js"><link rel="prefetch" href="/assets/js/388.eee34ec3.js"><link rel="prefetch" href="/assets/js/389.297f4874.js"><link rel="prefetch" href="/assets/js/390.b28b6f53.js"><link rel="prefetch" href="/assets/js/391.a029ae3e.js"><link rel="prefetch" href="/assets/js/392.24549e00.js"><link rel="prefetch" href="/assets/js/393.f99baca2.js"><link rel="prefetch" href="/assets/js/394.9d99ecd4.js"><link rel="prefetch" href="/assets/js/395.a3e8825d.js"><link rel="prefetch" href="/assets/js/396.42baf35c.js"><link rel="prefetch" href="/assets/js/397.7283f9b6.js"><link rel="prefetch" href="/assets/js/398.5dadbcb0.js"><link rel="prefetch" href="/assets/js/399.05d794dd.js"><link rel="prefetch" href="/assets/js/400.fa38d556.js"><link rel="prefetch" href="/assets/js/401.2bab03b2.js"><link rel="prefetch" href="/assets/js/402.485f8194.js"><link rel="prefetch" href="/assets/js/403.316d7bf9.js"><link rel="prefetch" href="/assets/js/404.f4862481.js"><link rel="prefetch" href="/assets/js/405.8fda67cc.js"><link rel="prefetch" href="/assets/js/406.e94eef70.js"><link rel="prefetch" href="/assets/js/407.7c5a3ff3.js"><link rel="prefetch" href="/assets/js/408.37e46fa0.js"><link rel="prefetch" href="/assets/js/409.6e3b680e.js"><link rel="prefetch" href="/assets/js/410.f682bfa0.js"><link rel="prefetch" href="/assets/js/411.7844b996.js"><link rel="prefetch" href="/assets/js/412.e51d9f1b.js"><link rel="prefetch" href="/assets/js/413.993668cc.js"><link rel="prefetch" href="/assets/js/414.ad44d7c5.js"><link rel="prefetch" href="/assets/js/415.75d5a4a1.js"><link rel="prefetch" href="/assets/js/416.2610f9d7.js"><link rel="prefetch" href="/assets/js/417.58526bb1.js"><link rel="prefetch" href="/assets/js/418.39cccc30.js"><link rel="prefetch" href="/assets/js/419.e40ad62e.js"><link rel="prefetch" href="/assets/js/420.9f23b952.js"><link rel="prefetch" href="/assets/js/421.bf69f4d8.js"><link rel="prefetch" href="/assets/js/422.47b76cad.js"><link rel="prefetch" href="/assets/js/423.72cac98f.js"><link rel="prefetch" href="/assets/js/424.c1051eda.js"><link rel="prefetch" href="/assets/js/425.ec6d01fa.js"><link rel="prefetch" href="/assets/js/426.b60965ef.js"><link rel="prefetch" href="/assets/js/427.2d67820d.js"><link rel="prefetch" href="/assets/js/428.b6e8dad2.js"><link rel="prefetch" href="/assets/js/429.f4f58833.js"><link rel="prefetch" href="/assets/js/430.fa27f570.js"><link rel="prefetch" href="/assets/js/431.173adee5.js"><link rel="prefetch" href="/assets/js/432.4467c22c.js"><link rel="prefetch" href="/assets/js/433.bc06dc2a.js"><link rel="prefetch" href="/assets/js/434.8cc2e21c.js"><link rel="prefetch" href="/assets/js/435.c6260018.js"><link rel="prefetch" href="/assets/js/436.1aa1a53f.js"><link rel="prefetch" href="/assets/js/437.54a612bf.js"><link rel="prefetch" href="/assets/js/438.bb57f36f.js"><link rel="prefetch" href="/assets/js/439.d3ebc030.js"><link rel="prefetch" href="/assets/js/440.cbc26776.js"><link rel="prefetch" href="/assets/js/441.4ac28efb.js"><link rel="prefetch" href="/assets/js/442.9777006f.js"><link rel="prefetch" href="/assets/js/443.56ec3be3.js"><link rel="prefetch" href="/assets/js/444.299f33a0.js"><link rel="prefetch" href="/assets/js/445.fd1d36f0.js"><link rel="prefetch" href="/assets/js/446.efaf3923.js"><link rel="prefetch" href="/assets/js/447.d1879ad2.js"><link rel="prefetch" href="/assets/js/448.a2dd7c35.js"><link rel="prefetch" href="/assets/js/449.8289d899.js"><link rel="prefetch" href="/assets/js/450.68dadf2d.js"><link rel="prefetch" href="/assets/js/451.1745b59b.js"><link rel="prefetch" href="/assets/js/452.19aa0c88.js"><link rel="prefetch" href="/assets/js/453.a87d0ccd.js"><link rel="prefetch" href="/assets/js/454.908cc62f.js"><link rel="prefetch" href="/assets/js/455.356e0c4d.js"><link rel="prefetch" href="/assets/js/456.aa4f04d4.js"><link rel="prefetch" href="/assets/js/457.409c19df.js"><link rel="prefetch" href="/assets/js/458.26ff7512.js"><link rel="prefetch" href="/assets/js/459.eec44061.js"><link rel="prefetch" href="/assets/js/460.b741c5a1.js"><link rel="prefetch" href="/assets/js/461.6d7a3745.js"><link rel="prefetch" href="/assets/js/462.b8e7e4de.js"><link rel="prefetch" href="/assets/js/463.1a2bc681.js"><link rel="prefetch" href="/assets/js/464.465ca9dc.js"><link rel="prefetch" href="/assets/js/465.63bc1e1c.js"><link rel="prefetch" href="/assets/js/466.71de700a.js"><link rel="prefetch" href="/assets/js/467.5b679cc0.js"><link rel="prefetch" href="/assets/js/468.b1a2dd7d.js"><link rel="prefetch" href="/assets/js/469.08638346.js"><link rel="prefetch" href="/assets/js/470.ab28934c.js"><link rel="prefetch" href="/assets/js/471.c011d01a.js"><link rel="prefetch" href="/assets/js/472.bfa6db4d.js"><link rel="prefetch" href="/assets/js/473.16c837aa.js"><link rel="prefetch" href="/assets/js/474.f03e177a.js"><link rel="prefetch" href="/assets/js/475.a9639567.js"><link rel="prefetch" href="/assets/js/476.dd3213d6.js"><link rel="prefetch" href="/assets/js/477.a64d9cc4.js"><link rel="prefetch" href="/assets/js/478.f9aacb36.js"><link rel="prefetch" href="/assets/js/479.e2c4a3e3.js"><link rel="prefetch" href="/assets/js/480.429a6157.js"><link rel="prefetch" href="/assets/js/481.298c5479.js"><link rel="prefetch" href="/assets/js/482.8e43593a.js"><link rel="prefetch" href="/assets/js/483.74f82d03.js"><link rel="prefetch" href="/assets/js/484.0e54cdc4.js"><link rel="prefetch" href="/assets/js/485.4a873bac.js"><link rel="prefetch" href="/assets/js/486.ef55260e.js"><link rel="prefetch" href="/assets/js/487.24d24a67.js"><link rel="prefetch" href="/assets/js/488.03094b8f.js"><link rel="prefetch" href="/assets/js/489.69c92426.js"><link rel="prefetch" href="/assets/js/490.ab67421d.js"><link rel="prefetch" href="/assets/js/491.39efdc39.js"><link rel="prefetch" href="/assets/js/492.0fde0ba2.js"><link rel="prefetch" href="/assets/js/493.f2ec5ab0.js"><link rel="prefetch" href="/assets/js/494.ff533e5d.js"><link rel="prefetch" href="/assets/js/495.7db1f702.js"><link rel="prefetch" href="/assets/js/496.cd7352eb.js"><link rel="prefetch" href="/assets/js/497.55629ebd.js"><link rel="prefetch" href="/assets/js/498.de8a8407.js">
    <link rel="stylesheet" href="/assets/css/499.styles.12267a2b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      AitSchool
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">DevTools</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/DeveloperTools/software/" class="nav-link">Software</a></li><li class="dropdown-item"><!----><a href="/DeveloperTools/github/" class="nav-link">Github &amp; Git</a></li><li class="dropdown-item"><!----><a href="/DeveloperTools/homestead/" class="nav-link">Homestead</a></li></ul></div></div><div class="nav-item"><a href="/html/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/javascript/" class="nav-link">JavaScript Basics</a></li><li class="dropdown-item"><!----><a href="/html5/" class="nav-link">JavaScript Web</a></li><li class="dropdown-item"><!----><a href="/experience/" class="nav-link">JavaScript Experience</a></li><li class="dropdown-item"><!----><a href="/package/" class="nav-link">JavaScript Package</a></li><li class="dropdown-item"><!----><a href="/nodejs/" class="nav-link">JavaScript Nodejs</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ExpressDelivery</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/ExpressDelivery/html/" class="nav-link">HTML 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/css/" class="nav-link">CSS 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/js/" class="nav-link">JavaScript 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/weixin/" class="nav-link">小程序 开发</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">framework</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/framework/mvc/" class="nav-link">MVC</a></li><li class="dropdown-item"><!----><a href="/framework/vdom/" class="nav-link">VDOM</a></li><li class="dropdown-item"><!----><a href="/framework/htmlparse/" class="nav-link">ParseHTML</a></li><li class="dropdown-item"><!----><a href="/framework/reactive/" class="nav-link">Reactive</a></li><li class="dropdown-item"><!----><a href="/framework/react/" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><a href="/task/" class="nav-link">Level X</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Question</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://www.google.com/" target="_blank" rel="noopener noreferrer" class="nav-link">Google</a></li><li class="dropdown-item"><!----><a href="https://www.baidu.com/" target="_blank" rel="noopener noreferrer" class="nav-link">Baidu</a></li><li class="dropdown-item"><!----><a href="https://segmentfault.com/" target="_blank" rel="noopener noreferrer" class="nav-link">segmentfault</a></li><li class="dropdown-item"><!----><a href="https://www.docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link">文档</a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">Guide</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">DevTools</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/DeveloperTools/software/" class="nav-link">Software</a></li><li class="dropdown-item"><!----><a href="/DeveloperTools/github/" class="nav-link">Github &amp; Git</a></li><li class="dropdown-item"><!----><a href="/DeveloperTools/homestead/" class="nav-link">Homestead</a></li></ul></div></div><div class="nav-item"><a href="/html/" class="nav-link">HTML</a></div><div class="nav-item"><a href="/css/" class="nav-link">CSS</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">JavaScript</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/javascript/" class="nav-link">JavaScript Basics</a></li><li class="dropdown-item"><!----><a href="/html5/" class="nav-link">JavaScript Web</a></li><li class="dropdown-item"><!----><a href="/experience/" class="nav-link">JavaScript Experience</a></li><li class="dropdown-item"><!----><a href="/package/" class="nav-link">JavaScript Package</a></li><li class="dropdown-item"><!----><a href="/nodejs/" class="nav-link">JavaScript Nodejs</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">ExpressDelivery</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/ExpressDelivery/html/" class="nav-link">HTML 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/css/" class="nav-link">CSS 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/js/" class="nav-link">JavaScript 开发</a></li><li class="dropdown-item"><!----><a href="/ExpressDelivery/weixin/" class="nav-link">小程序 开发</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">framework</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="/framework/mvc/" class="nav-link">MVC</a></li><li class="dropdown-item"><!----><a href="/framework/vdom/" class="nav-link">VDOM</a></li><li class="dropdown-item"><!----><a href="/framework/htmlparse/" class="nav-link">ParseHTML</a></li><li class="dropdown-item"><!----><a href="/framework/reactive/" class="nav-link">Reactive</a></li><li class="dropdown-item"><!----><a href="/framework/react/" class="nav-link">React</a></li></ul></div></div><div class="nav-item"><a href="/task/" class="nav-link">Level X</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Question</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://www.google.com/" target="_blank" rel="noopener noreferrer" class="nav-link">Google</a></li><li class="dropdown-item"><!----><a href="https://www.baidu.com/" target="_blank" rel="noopener noreferrer" class="nav-link">Baidu</a></li><li class="dropdown-item"><!----><a href="https://segmentfault.com/" target="_blank" rel="noopener noreferrer" class="nav-link">segmentfault</a></li><li class="dropdown-item"><!----><a href="https://www.docschina.org/" target="_blank" rel="noopener noreferrer" class="nav-link">文档</a></li></ul></div></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>技术成就梦想之美</span><!----></p><ul class="sidebar-group-items"><li><a href="/" class="sidebar-link">导航</a></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="_3-3-小程序登录页面"><a href="#_3-3-小程序登录页面" aria-hidden="true" class="header-anchor">#</a> 3.3 小程序登录页面</h1><p>这一节我们来实现小程序登录功能。LaraBBS 是一个论坛类应用，用户角色分为 <code>游客</code> 和 <code>登录用户</code>，<code>游客</code> 可以正常的浏览话题列表，浏览话题回复，切换各种分类下的话题。涉及到 <code>发布话题</code>，<code>发布回复</code>，<code>修改个人信息</code> 等操作时，才需要用户登录。小程序的产品体验应当与 LaraBBS 一致。</p><h2 id="支持-async-await"><a href="#支持-async-await" aria-hidden="true" class="header-anchor">#</a> 支持 Async/Await</h2><p><a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="noopener noreferrer">Async/Await</a> 是 ES7 的新特性，得益于 <a href="https://babeljs.cn/" target="_blank" rel="noopener noreferrer">Babel</a> 我们可以提前使用该特性，Babel 是一个广泛使用的转码器，可以将代码转为 ES5 代码，简单的解释就是将高版本的代码转换为低版本，从而在低版本环境中执行。</p><p>为了理解 <code>Async/Await</code> 举个简单的例子：</p><p><code>wepy.login()</code> 是微信提供的接口，用于获取临时登录凭证 <code>Code</code>，这是个异步的调用，原生小程序开发需要定义 <code>success</code> 回调方法：</p><pre class="language-js"><code><span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 原生小程序开发</span>
  wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    success<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>在 WePY 中我们可以使用 <code>Promise</code>，进一步简化了代码，可以采用链式写法：</p><pre class="language-js"><code><span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// WePY 中使用 Promise</span>
  wepy<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>res <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'login: '</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>有了 <code>Await</code> 后我们发现代码变成了一行，只需要在异步调用前增加  <code>await</code>，就可以用同步的方式处理异步代码了，增加了代码的可读性，方便理解和使用：</p><pre class="language-js"><code><span class="token keyword">async</span> <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// WePY 中使用 Await</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> wepy<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>大家可以先有个基本概念，随着课程实践，会对 <code>Async/Await</code> 有更加深入的理解。</p><blockquote><p>需要注意的是如果方法中使用了 <code>await</code> 那么方法前必须增加 <code>async</code> 关键字。</p></blockquote><p>为了在 WePY 中使用 <code>async/await</code>，我们需要手动安装 <code>wepy-async-function</code>，框架的 <a href="https://github.com/Tencent/wepy/wiki/wepy%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8async-await" target="_blank" rel="noopener noreferrer">文档</a> 中有具体说明。</p><pre class="language-bash"><code>$ <span class="token function">cd</span> ~/Code/larabbs-weapp
$ yarn add wepy-async-function
</code></pre><p>在 <code>app.wpy</code> 中引入引入 <code>wepy-async-function</code>，同时删除上一节的测试代码：</p><p><em>app.wpy</em></p><pre class="language-js"><code><span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token keyword">import</span> wepy <span class="token keyword">from</span> <span class="token string">'wepy'</span>
<span class="token keyword">import</span> <span class="token string">'wepy-async-function'</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
  <span class="token punctuation">.</span>
  <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
</code></pre><p>重新编译并监听</p><pre class="language-bash"><code>$ wepy build --no-cache --watch
</code></pre><p><img src="/assets/img/3.3_1.ef41b53f.png" alt="file"></p><h2 id="创建登录页面"><a href="#创建登录页面" aria-hidden="true" class="header-anchor">#</a> 创建登录页面</h2><p>首先需要手动创建一个登录页面 <code>login.wpy</code>，根据功能区分，放在 <code>pages/auth</code> 目录中。</p><pre class="language-bash"><code>$ <span class="token function">cd</span> ~/Code/larabbs-weapp
$ <span class="token function">mkdir</span> src/pages/auth
$ <span class="token function">touch</span> src/pages/auth/login.wpy
</code></pre><p>不要忘记小程序中所有页面都必须配置在 <code>app.wpy</code> 中的 <code>pages</code> 选项中才可以使用：</p><p><em>src/app.wpy</em></p><pre class="language-js"><code><span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
  config <span class="token operator">=</span> <span class="token punctuation">{</span>
    pages<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token string">'pages/index'</span><span class="token punctuation">,</span>
      <span class="token string">'pages/user'</span><span class="token punctuation">,</span>
      <span class="token string">'pages/auth/login'</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
<span class="token punctuation">.</span>
</code></pre><h2 id="封装接口请求"><a href="#封装接口请求" aria-hidden="true" class="header-anchor">#</a> 封装接口请求</h2><p>我们可以对小程序提供的网络请求进行一次封装，例如每个网络请求都能在请求开始前，显示 <code>Loading</code> 加载提示，请求结束后取消加载提示，方便之后其他地方调用。可以新建一个 <code>untils</code> 目录，在这个目录中放我们封装的工具文件。</p><pre class="language-bash"><code>$ <span class="token function">mkdir</span> src/utils
</code></pre><p>在 <code>untils</code> 工具目录中，新增一个 <code>api.js</code> 文件，将后端接口请求相关的代码封装在该文件中，接下来的课程会继续将 <code>刷新 Token</code>，<code>退出登录</code>，<code>上传文件</code> 等逻辑封装在该文件中。</p><pre class="language-bash"><code>$ <span class="token function">touch</span> src/utils/api.js
</code></pre><p>修改文件如下：</p><p><em>src/utils/api.js</em></p><pre class="language-js"><code><span class="token keyword">import</span> wepy <span class="token keyword">from</span> <span class="token string">'wepy'</span>

<span class="token comment">// 服务器接口地址</span>
<span class="token keyword">const</span> host <span class="token operator">=</span> <span class="token string">'http://larabbs.test/api'</span>

<span class="token comment">// 普通请求</span>
<span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>options<span class="token punctuation">,</span> showLoading <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 简化开发，如果传入字符串则转换成 对象</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> options <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span>
      url<span class="token punctuation">:</span> options
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 显示加载中</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>showLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wepy<span class="token punctuation">.</span><span class="token function">showLoading</span><span class="token punctuation">(</span><span class="token punctuation">{</span>title<span class="token punctuation">:</span> <span class="token string">'加载中'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 拼接请求地址</span>
  options<span class="token punctuation">.</span>url <span class="token operator">=</span> host <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> options<span class="token punctuation">.</span>url
  <span class="token comment">// 调用小程序的 request 方法</span>
  <span class="token keyword">let</span> response <span class="token operator">=</span> <span class="token keyword">await</span> wepy<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>showLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 隐藏加载中</span>
    wepy<span class="token punctuation">.</span><span class="token function">hideLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 服务器异常后给与提示</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wepy<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
      content<span class="token punctuation">:</span> <span class="token string">'服务器错误，请联系管理员或重试'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> response
<span class="token punctuation">}</span>

<span class="token comment">// 登录</span>
<span class="token keyword">const</span> login <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>params <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// code 只能使用一次，所以每次单独调用</span>
  <span class="token keyword">let</span> loginData <span class="token operator">=</span> <span class="token keyword">await</span> wepy<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// 参数中增加code</span>
  params<span class="token punctuation">.</span>code <span class="token operator">=</span> loginData<span class="token punctuation">.</span>code

  <span class="token comment">// 接口请求 weapp/authorizations</span>
  <span class="token keyword">let</span> authResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    url<span class="token punctuation">:</span> <span class="token string">'weapp/authorizations'</span><span class="token punctuation">,</span>
    data<span class="token punctuation">:</span> params<span class="token punctuation">,</span>
    method<span class="token punctuation">:</span> <span class="token string">'POST'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 登录成功，记录 token 信息</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>authResponse<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">201</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    wepy<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">,</span> authResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>access_token<span class="token punctuation">)</span>
    wepy<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'access_token_expired_at'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> authResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>expires_in <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> authResponse
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  request<span class="token punctuation">,</span>
  login
<span class="token punctuation">}</span>
</code></pre><p>上面的代码中用到了以下几个小程序接口：</p><ul><li>wepy.showLoading——显示加载框；</li><li>wepy.hideLoading——与 <code>showLoading</code> 对应，隐藏加载框，注意应该成对出现；</li><li><a href="https://developers.weixin.qq.com/miniprogram/dev/api/data.html" target="_blank" rel="noopener noreferrer">wepy.setStorageSync</a>——设置缓存中的某个数据; 与之对应的是 <code>getStorageSync</code> ，获取缓存中的某个数据；</li><li>wepy.showModal——显示一个模态框。</li><li>wepy.request——发起网络请求，参数主要包括：
<ul><li>url——接口地址；</li><li>data——请求的参数；</li><li>header——请求的 header；</li><li>method——请求的方法，有效值：OPTIONS，GET，HEAD，POST，PUT，DELETE，TRACE，CONNECT。</li></ul></li></ul><p>这里封装了两个方法，<code>request</code> 和 <code>login</code>，注意这里使用了 ES6 中的 <a href="http://es6.ruanyifeng.com/#docs/function#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0" target="_blank" rel="noopener noreferrer">箭头函数</a> 来定义方法，分析一下代码逻辑：</p><ol><li>首先使用 <code>const</code> 定义了一个常量 <code>const host = 'http://larabbs.test/api'</code>，对应后端的接口地址；</li><li>封装了 <code>request</code> 方法，主要是对框架提供的 <code>request</code> 方法的封装，默认在请求之前显示加载中，如果接口返回 500 则给出错误提示等；</li><li>封装了 <code>login</code> 方法，主要是是对登录逻辑的封装，如果登录成功，则将 <code>access_token</code> 和过期时间存入 <code>storage</code> 中。</li></ol><p>小程序网络请求的结果 <code>authResponse</code> 主要结构如下：</p><ul><li>data —— 接口响应数据，包含 <code>access_token</code>，<code>expires_in</code>，<code>token_type</code>；</li><li>header —— 接口响应的的header 数据；</li><li>statusCode —— 接口响应状态码，判断接口是否调用成功；</li></ul><p>观察对象结构，你会发现 <code>authResponse.data</code> 对应着接口的响应数据，通过  <code>authResponse.data.access_token</code> 才能拿到接口返回的 <code>access_token</code>。因为 Token 相关的数据是全局共用，长期有效的数据，所以存放在数据缓存 （ Storage ） 中非常合适，通过 <code>getStorageSync</code> 即可获取到数据。</p><ol start="4"><li>最后我们使用 <code>export default</code> 抛出了定义的这两个方法，这样只需要 <code>import api from '@/utils/api'</code> 引入 <code>api.js</code> 文件后，就可以通过 <code>api.request</code> 和 <code>api.login</code> 来调用方法了。</li></ol><h2 id="修改登录页面"><a href="#修改登录页面" aria-hidden="true" class="header-anchor">#</a> 修改登录页面</h2><p>打开登录页面，填入如下内容：</p><p><em>src/pages/auth/login.wpy</em></p><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>less<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
<span class="token selector">.login-wrap</span> <span class="token punctuation">{</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>page<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>page__bd login-wrap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-toptips weui-toptips_warn<span class="token punctuation">&quot;</span></span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ errorMessage }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ errorMessage }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cells__title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Larabbs 用户登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cells weui-cells_after-title<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell weui-cell_input {{ error ? <span class="token punctuation">'</span>weui-cell_warn<span class="token punctuation">'</span> : <span class="token punctuation">'</span><span class="token punctuation">'</span>}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell__hd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>用户名<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell__bd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-input<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>手机号或邮箱<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bindUsernameInput<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ error }}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell__ft<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>warn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>23<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#E64340<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell weui-cell_input {{ error ? <span class="token punctuation">'</span>weui-cell_warn<span class="token punctuation">'</span> : <span class="token punctuation">'</span><span class="token punctuation">'</span>}}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell__hd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-label<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>密码<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell__bd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-input<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>输入密码<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@input</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bindPasswordInput<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ error }}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell__ft<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>warn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>23<span class="token punctuation">&quot;</span></span> <span class="token attr-name">color</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>#E64340<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>

      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-btn-area<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-btn<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>primary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@tap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
  <span class="token keyword">import</span> wepy <span class="token keyword">from</span> <span class="token string">'wepy'</span>
  <span class="token keyword">import</span> api <span class="token keyword">from</span> <span class="token string">'@/utils/api'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">wepy<span class="token punctuation">.</span>page</span> <span class="token punctuation">{</span>
    config <span class="token operator">=</span> <span class="token punctuation">{</span>
      navigationBarTitleText<span class="token punctuation">:</span> <span class="token string">'登录'</span>
    <span class="token punctuation">}</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// 用户名</span>
      username<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token comment">// 密码</span>
      password<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
      <span class="token comment">// 是否有错</span>
      error<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token comment">// 错误信息</span>
      errorMessage<span class="token punctuation">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
    methods <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// 绑定用户名 input 变化</span>
      <span class="token function">bindUsernameInput</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 绑定密码 input 变化</span>
      <span class="token function">bindPasswordInput</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>password <span class="token operator">=</span> e<span class="token punctuation">.</span>detail<span class="token punctuation">.</span>value
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 表单提交</span>
      <span class="token keyword">async</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 提交时重置错误</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>errorMessage <span class="token operator">=</span> <span class="token string">''</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>username <span class="token operator">||</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>errorMessage <span class="token operator">=</span> <span class="token string">'请填写账户名和密码'</span>
          <span class="token keyword">return</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 获取用户名和密码</span>
        <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token punctuation">{</span>
          username<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span>
          password<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>password
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> authResponse <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>

          <span class="token comment">// 请求结果为 401 说明用户名和密码错误，显示错误提示</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>authResponse<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token boolean">true</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>errorMessage <span class="token operator">=</span> authResponse<span class="token punctuation">.</span>data<span class="token punctuation">.</span>message
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$apply</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// 201 为登录正确，返回上一页</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>authResponse<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">201</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            wepy<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          wepy<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            title<span class="token punctuation">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
            content<span class="token punctuation">:</span> <span class="token string">'服务器错误，请联系管理员'</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 页面打开事件</span>
    <span class="token keyword">async</span> <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token comment">// 打开页面自动调用一次登录</span>
        <span class="token keyword">let</span> authResponse <span class="token operator">=</span> <span class="token keyword">await</span> api<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// 登录成功返回上一页</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>authResponse<span class="token punctuation">.</span>statusCode <span class="token operator">===</span> <span class="token number">201</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          wepy<span class="token punctuation">.</span><span class="token function">navigateBack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wepy<span class="token punctuation">.</span><span class="token function">showModal</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          title<span class="token punctuation">:</span> <span class="token string">'提示'</span><span class="token punctuation">,</span>
          content<span class="token punctuation">:</span> <span class="token string">'服务器错误，请联系管理员'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre><p>在文件中我们添加了很多内容，如果你之前没有了解过 Vue 或者 MVVM，可能会有点陌生，不必担心，我们一点一点分析一下代码，随着后面的使用，你会有更深入的认识。</p><h3 id="模板代码"><a href="#模板代码" aria-hidden="true" class="header-anchor">#</a> 模板代码</h3><p>模板中需要学习以下几个新的知识点：</p><ol><li><a href="https://developers.weixin.qq.com/miniprogram/dev/framework/view/wxml/conditional.html" target="_blank" rel="noopener noreferrer">wx:if</a> ——小程序提供的标签控制属性，<code>wx:if=&quot;&quot;</code> 当 <code>data</code> 中定义的 <code>error</code> 值为 True 时才会显示整个代码块；</li><li>@input —— 输入框输入事件，@ 符号是 WePY 为我们提供的事件修饰符，相比原生小程序开发的 <code>bindinput=&quot;bindUsernameInput&quot;</code> 要更加简便。 <code>@input=&quot;bindUsernameInput&quot;</code> 表示当数据框输入时，便会调用 methods 中定义的 <code>bindUsernameInput</code> 方法；</li><li>@tap —— 手指触摸后离开事件。</li></ol><p>模板内容很简单，两个输入框，用户名和密码，用户输入后点击 <code>登录</code> 按钮，因为绑定了 <code>@tap=&quot;submit&quot;</code>，用户点击过后调用 <code>submit</code> 方法，执行登录的逻辑。</p><h3 id="js-交互逻辑"><a href="#js-交互逻辑" aria-hidden="true" class="header-anchor">#</a> JS 交互逻辑</h3><p>首先来看一下代码结构：</p><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token keyword">extends</span> <span class="token class-name">wepy<span class="token punctuation">.</span>page</span> <span class="token punctuation">{</span>
    config <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    methods <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">bindUsernameInput</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token function">bindPasswordInput</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">async</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
    <span class="token keyword">async</span> <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><ul><li>config —— 页面配置，我们在其中增加了 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/config.html" target="_blank" rel="noopener noreferrer">navigationBarTitleText</a> 配置，是导航栏标题文字内容，每个页面都可单独定义，这里我们显示为 <code>登录</code>。如果不定义则显示 <code>src/app.wpy</code> 中定义的 <code>window.navigationBarTitleText</code> 显示为 <code>LaraBBS</code>；</li><li>data —— 模板中需要数据绑定的数据，定义了用户名（username）和密码（password），以及错误信息 <code>errors</code> 和 <code>errorMessage</code>；</li><li>methods —— 绑定的事件处理函数，所有的 <code>事件处理函数</code>，必须定义在 <code>methods</code> 对象中；
<ul><li>bindUsernameInput —— 绑定的用户输入用户名的处理函数，赋值给 <code>username</code>；</li><li>bindPasswordInput —— 绑定用户输入密码的处理函数，赋值给 <code>password</code>；</li><li>submit —— 用户点击登录处理函数。</li></ul></li><li>onShow ——小程序生命周期函数。</li></ul><p>用户打开登录页面后，便会触发 onShow 方法，这里需要了解一下小程序页面的生命周期函数：</p><blockquote><p>onLoad: 页面加载 —— 一个页面只会调用一次；
onShow: 页面显示——每次打开页面都会调用一次；
onReady: 页面初次渲染完成——一个页面只会调用一次，代表页面已经准备妥当，可以和视图层进行交互；
onHide: 页面隐藏——当 navigateTo 或底部 tab 切换时调用；
onUnload: 页面卸载——当 redirectTo 或 navigateBack 的时候调用。</p></blockquote><p>在 <code>onShow</code> 方法中调用一次我们封装的登录逻辑 <code>api.login()</code>，如果找到微信 openid 对应的用户，则保存 Token，调用 <code>navigateBack()</code> 返回之前的页面。</p><p>如果用户还未绑定用户，则输入用户名和密码，点击登录，执行 <code>submit</code> 方法分析：</p><ol><li>如果用户名或者密码未输入完整，则提示错误信息 <code>请填写账户名和密码</code>；</li><li>用户输入用户名和密码后，点击提交后，调用小程序登录接口；</li><li>用户名密码错误时接口返回 401，提示用户用户名或密码错误；</li><li>登录成功返回 201 后，返回之前的页面。</li></ol><p>WePY 让我们可以直接使用简化了数据绑定的方式，直接使用 <code>this.error = true</code> 就可以更新 data 中的数据，如果使用原生的开发方式我们必须使用 <code>setData</code> 方法。但是注意 <strong>在异步函数中更新数据的时，必须手动调用 <code>this.$apply()</code> 方法，才会触发脏数据检查流程的运行</strong>，也就是存在异步调用的方法中，要更新 data 中某个数据时必须调用一次 <code>this.$apply()</code>。</p><p>还需要注意的是，涉及到异步处理，例如网络请求的时候，增加 <code>try/catch</code> 会让你的代码更加安全，比如调用 <code>登录接口</code> 时我们就使用了下面的结构：</p><pre class="language-bash"><code>try <span class="token punctuation">{</span>
  <span class="token keyword">.</span>
  <span class="token keyword">.</span>
  <span class="token keyword">.</span>
<span class="token punctuation">}</span> catch <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  wepy.showModal<span class="token punctuation">(</span><span class="token punctuation">{</span>
    title: <span class="token string">'提示'</span>,
    content: <span class="token string">'服务器错误，请联系管理员'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><p>有任何的异常便会调用 <code>wepy.showModal</code> 方法提示 <code>服务器错误，请联系管理员</code>。</p><h2 id="修改我的页面"><a href="#修改我的页面" aria-hidden="true" class="header-anchor">#</a> 修改我的页面</h2><p><em>src/pages/user.wpy</em></p><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>page<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>{{ loggedIn }}<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      已登录
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name"><span class="token namespace">wx:</span>else</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>navigator</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell weui-cell_access<span class="token punctuation">&quot;</span></span> <span class="token attr-name">url</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>/pages/auth/login<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell__bd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>未登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>weui-cell__ft weui-cell__ft_in-access<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>navigator</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
  <span class="token keyword">import</span> wepy <span class="token keyword">from</span> <span class="token string">'wepy'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">wepy<span class="token punctuation">.</span>page</span> <span class="token punctuation">{</span>
    config <span class="token operator">=</span> <span class="token punctuation">{</span>
      navigationBarTitleText<span class="token punctuation">:</span> <span class="token string">'我的'</span>
    <span class="token punctuation">}</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
      loggedIn<span class="token punctuation">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>
    <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>wepy<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">'access_token'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loggedIn <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

</code></pre><p>代码逻辑很简单，我们将 <code>login</code> 页面的链接放在 <code>我的</code> 页面中，<code>onShow</code> 的时候，也就是切换到 <code>我的</code> 页面时，判断 <code>storage</code> 中是否已经存在 <code>access_token</code>，来显示用户是否已经登录。</p><h2 id="开发者工具调试"><a href="#开发者工具调试" aria-hidden="true" class="header-anchor">#</a> 开发者工具调试</h2><p>在调试之前，我们先将开发者工具的 <code>不校验合法域名、web-view（业务域名）、TLS 版本以及 HTTPS 证书</code> 选项打开，这样我们就能使用本地的非 <code>https</code> 域名进行调试。</p><p><img src="/assets/img/3.3_2.c8f079a8.png" alt="file"></p><ol><li>小程序未绑定用户，跳转到登录页面：</li></ol><p><img src="/assets/img/3.3_3.5b4e52c8.gif" alt="file"></p><ol start="2"><li>输入错误的 <code>用户名</code> 和 <code>密码</code>，提示用户名密码错误：</li></ol><p><img src="/assets/img/3.3_4.e01a6a3c.gif" alt="file"></p><ol start="3"><li>在 http://larabbs.test 中注册或者找到一个已存在的用户，正确输入用户的 <code>用户名</code> 和 <code>密码</code>，登录成功，跳转回我的页面：</li></ol><p><img src="/assets/img/3.3_5.95e7925f.gif" alt="file"></p><ol start="4"><li>清除缓存，再次点击登录，直接登录成功，跳转回我的页面：</li></ol><p><img src="/assets/img/3.3_6.51ab3ed9.gif" alt="file"></p><h2 id="代码版本控制"><a href="#代码版本控制" aria-hidden="true" class="header-anchor">#</a> 代码版本控制</h2><pre class="language-bash"><code>$ <span class="token function">cd</span> ~/Code/larabbs-weapp
$ <span class="token function">git</span> add -A
$ <span class="token function">git</span> commit -m <span class="token string">'page login'</span>
</code></pre></div><!----><!----></div></div></div>
    <script src="/assets/js/222.1d132cf7.js" defer></script><script src="/assets/js/app.8c64503a.js" defer></script>
  </body>
</html>
