(window.webpackJsonp=window.webpackJsonp||[]).push([[209],{1250:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"_6-2-优化最后更新时间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-优化最后更新时间","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.2 优化最后更新时间")]),n("p",[t._v("上一节的话题列表中，话题的 "),n("code",[t._v("更新时间")]),t._v(" 我们直接使用了话题的 "),n("code",[t._v("updated_at")]),t._v(" 属性，更好的显示方式为 "),n("code",[t._v("x 分钟前")]),t._v("，"),n("code",[t._v("x 小时前")]),t._v("。在 PHP 中我们可以使用 "),n("a",{attrs:{href:"http://carbon.nesbot.com/docs/#api-localization",target:"_blank",rel:"noopener noreferrer"}},[t._v("Carbon")]),t._v(" 的 "),n("code",[t._v("diffForHumans")]),t._v(" 方法格式化时间，小程序中我们也需要一个类似的工具。"),n("a",{attrs:{href:"http://momentjs.cn/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Moment.js")]),t._v(" 就是这样一个处理时间的工具，下面我们来安装并使用它。")]),n("p",[t._v("很多人可能第一时间想到的解决方案是修改接口，让接口默认将时间格式化为 "),n("code",[t._v("x 分钟前")]),t._v("，这样虽说能解决问题，但是十分不推荐，因为：")]),n("ol",[n("li",[t._v("接口不应该知道客户端需要如何显示数据，接口只需要做到数据统一，时间应该返回统一的格式；")]),n("li",[t._v("接口是独立的，不会与页面耦合，不应该因为客户端的显示需求而修改接口。")])]),n("h3",{attrs:{id:"安装-moment-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装-moment-js","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装 Moment.js")]),n("p",[t._v("首先需要安装 Moment.js：")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" ~/Code/larabbs-weapp\n$ yarn add moment\n")])]),n("p",[n("img",{attrs:{src:a(504),alt:"file"}})]),n("h3",{attrs:{id:"封装工具方法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#封装工具方法","aria-hidden":"true"}},[t._v("#")]),t._v(" 封装工具方法")]),n("p",[t._v("时间格式化应该封装成一个工具方法，放在一个工具文件中，我们可以在 "),n("code",[t._v("utils")]),t._v(" 目录中，创建 "),n("code",[t._v("util.js")]),t._v(" 文件，将一些工具方法封装在该文件中，类似于 Laravel 的辅助方法。")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{attrs:{class:"token function"}},[t._v("touch")]),t._v(" src/utils/util.js\n")])]),n("p",[t._v("修改 "),n("code",[t._v("utils.js")]),t._v("：")]),n("p",[n("em",[t._v("src/utils/util.js")])]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" moment "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'moment'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'moment/locale/zh-cn'")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" diffForHumans "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("date"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" format"),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token string"}},[t._v("'YYYYMMDD H:mm:ss'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  moment"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("locale")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'zh-cn'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("moment")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("date"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" format"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("fromNow")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  diffForHumans\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),n("p",[t._v("我们封装了一个方法 "),n("code",[t._v("diffForHumans")]),t._v("，使用了中文的语言包，通过 "),n("code",[t._v("moment")]),t._v(" 的 "),n("code",[t._v("fromNow")]),t._v("，格式化时间。")]),n("h3",{attrs:{id:"调整代码"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#调整代码","aria-hidden":"true"}},[t._v("#")]),t._v(" 调整代码")]),n("p",[n("em",[t._v("src/pages/toipcs/index.wpy")])]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n  "),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("view "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token string"}},[t._v('"weui-media-box__info__meta"')]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" topic"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("name "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" • "),n("span",{attrs:{class:"token operator"}},[t._v("<")]),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("view"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  "),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("view "),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token string"}},[t._v('"weui-media-box__info__meta"')]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" topic"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updated_at_diff "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token operator"}},[t._v("<")]),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("view"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" api "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'@/utils/api'")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" util "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'@/utils/util'")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("getTopics")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("page "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reset "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" topics "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" topicsResponse"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("data\n        topics"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          topic"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updated_at_diff "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" util"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("diffForHumans")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("updated_at"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("p",[t._v("引入工具 "),n("code",[t._v("util.js")]),t._v("，在 "),n("code",[t._v("getTopics")]),t._v(" 方法中我们使用 "),n("code",[t._v("forEach")]),t._v("，将每个话题数据中增加 "),n("code",[t._v("updated_at_diff")]),t._v(" 属性，属性值为 "),n("code",[t._v("updated_at")]),t._v(" 格式化后的结果，最终在页面中显示 "),n("code",[t._v("updated_at_diff")]),t._v("。")]),n("p",[n("img",{attrs:{src:a(503),alt:"file"}})]),n("p",[t._v("打开页面查看结果，可以正确显示最后更新时间。")]),n("h2",{attrs:{id:"代码版本控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#代码版本控制","aria-hidden":"true"}},[t._v("#")]),t._v(" 代码版本控制")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" ~/Code/larabbs-weapp\n$ "),n("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" add -A\n$ "),n("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),n("span",{attrs:{class:"token string"}},[t._v("'add moment.js'")]),t._v("\n")])])])}],o=a(0),e=Object(o.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);s.default=e.exports},503:function(t,s,a){t.exports=a.p+"assets/img/6.2_2.0f8c06cb.png"},504:function(t,s,a){t.exports=a.p+"assets/img/6.2_1.6ca60b84.png"}}]);