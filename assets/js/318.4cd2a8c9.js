(window.webpackJsonp=window.webpackJsonp||[]).push([[318],{1414:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"_4-5-xss"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-xss","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.5 XSS")])},function(){var t=this.$createElement,s=this._self._c||t;return s("blockquote",[s("p",[this._v("永远不要信任用户提交的数据。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们在创建话题时对用户提交的内容字段 "),s("code",[this._v("body")]),this._v(" 太过信任，没有对其做过滤处理，即原封不动的显示在页面上，这是非常危险的。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("一种比较常见的 XSS 攻击是 Cookie 窃取。我们都知道网站是通过 Cookie 来辨别用户身份的，一旦恶意攻击者能在页面中执行 JavaScript 代码，他们即可通过 JavaScript 读取并窃取你的 Cookie，拿到你的 Cookie 以后即可伪造你的身份登录网站。（扩展阅读 —— "),s("a",{attrs:{href:"https://www.ibm.com/developerworks/cn/rational/08/0325_segal/",target:"_blank",rel:"noopener noreferrer"}},[this._v(" IBM 文档库：跨站点脚本攻击深入解析 ")]),this._v("）")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("第一种，对用户提交的数据进行过滤；")]),s("li",[this._v("第二种，Web 网页显示时对数据进行特殊处理，一般使用 "),s("code",[this._v("htmlspecialchars()")]),this._v(" 输出。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("topic-body"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  {!! $topic->body !!}\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Blade 的 "),s("code",[this._v("{!! !!}")]),this._v(" 语法是直接数据，不会对数据做任何处理。在我们这种场景下，因为业务逻辑的特殊性，第二种方法不适用，我们将使用第一种方法，对用户提交的数据进行过滤来避免 XSS 攻击。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"布置舞台"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#布置舞台","aria-hidden":"true"}},[this._v("#")]),this._v(" 布置舞台")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token script language-javascript"}},[a("span",{attrs:{class:"token function"}},[t._v("alert")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'存在 XSS 安全威胁！'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")])]),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(921),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(920),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("为了方便测试，我们在编辑器中注释掉 Simditor 的代码调用（快捷键 "),s("code",[this._v("Ctrl + /")]),this._v("）：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(919),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(918),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(917),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"htmlpurifier"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#htmlpurifier","aria-hidden":"true"}},[this._v("#")]),this._v(" HTMLPurifier")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("a",{attrs:{href:"http://htmlpurifier.org/",target:"_blank",rel:"noopener noreferrer"}},[this._v("HTMLPurifier")]),this._v(" 本身就是一个独立的项目，运用『白名单机制』对 HTML 文本信息进行 XSS 过滤。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("『白名单机制』指的是使用配置信息来定义『HTML 标签』、『标签属性』和『CSS 属性』数组，在执行 "),s("code",[this._v("clean()")]),this._v(" 方法时，只允许配置信息『白名单』里出现的元素通过，其他都进行过滤。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'HTML.Allowed'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'div,em,a[href|title|style],ul,ol,li,p[style],br'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'CSS.AllowedProperties'")]),t._v("    "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'font,font-size,font-weight,font-style,font-family'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("someproperty")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("somevalue"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://example.com"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token style-attr language-css"}},[a("span",{attrs:{class:"token attr-name"}},[t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("style")])]),a("span",{attrs:{class:"token punctuation"}},[t._v('="')]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token property"}},[t._v("color")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("#ccc"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{attrs:{class:"token property"}},[t._v("font-size")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("16px")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    文章内容"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token script language-javascript"}},[a("span",{attrs:{class:"token function"}},[t._v("alert")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Alerted'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")])]),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("http://example.com"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token style-attr language-css"}},[a("span",{attrs:{class:"token attr-name"}},[t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("style")])]),a("span",{attrs:{class:"token punctuation"}},[t._v('="')]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token property"}},[t._v("font-size")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v("16px")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    文章内容\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[s("code",[this._v("someproperty")]),this._v(" 未指定的 HTML 属性")]),s("li",[s("code",[this._v("color")]),this._v(" 未指定的 CSS 属性")]),s("li",[s("code",[this._v("script")]),this._v(" 未指定的 HTML 标签")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"htmlpurifier-for-laravel-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#htmlpurifier-for-laravel-5","aria-hidden":"true"}},[this._v("#")]),this._v(" HTMLPurifier for Laravel 5")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("a",{attrs:{href:"https://github.com/mewebstudio/Purifier",target:"_blank",rel:"noopener noreferrer"}},[this._v("HTMLPurifier for Laravel")]),this._v(" 是对 HTMLPurifier 针对 Laravel 框架的一个封装。本章节中，我们将使用此扩展包来对用户内容进行过滤。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-安装-htmlpurifier-for-laravel-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装-htmlpurifier-for-laravel-5","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. 安装 HTMLPurifier for Laravel 5")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ composer require "),s("span",{attrs:{class:"token string"}},[this._v('"mews/purifier:~2.0"')]),this._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-配置-htmlpurifier-for-laravel-5"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置-htmlpurifier-for-laravel-5","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.  配置 HTMLPurifier for Laravel 5")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ php artisan vendor:publish --provider"),s("span",{attrs:{class:"token operator"}},[this._v("=")]),s("span",{attrs:{class:"token string"}},[this._v('"Mews\\Purifier\\PurifierServiceProvider"')]),this._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("config/purifier.php")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token php language-php"}},[a("span",{attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'encoding'")]),t._v("      "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'UTF-8'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'finalize'")]),t._v("      "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'cachePath'")]),t._v("     "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("storage_path")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'app/purifier'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'cacheFileMode'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("0755")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'settings'")]),t._v("      "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'user_topic_body'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'HTML.Doctype'")]),t._v("             "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'XHTML 1.0 Transitional'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'HTML.Allowed'")]),t._v("             "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'div,b,strong,i,em,a[href|title],ul,ol,ol[start],li,p[style],br,span[style],img[width|height|alt|src],*[style|class],pre,hr,code,h2,h3,h4,h5,h6,blockquote,del,table,thead,tbody,tr,th,td'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'CSS.AllowedProperties'")]),t._v("    "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'font,font-size,font-weight,font-style,margin,width,height,font-family,text-decoration,padding-left,color,background-color,text-align'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'AutoFormat.AutoParagraph'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'AutoFormat.RemoveEmpty'")]),t._v("   "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("配置里的 "),s("code",[this._v("user_topic_body")]),this._v(" 是我们为话题内容定制的，配合 "),s("code",[this._v("clean()")]),this._v(" 方法使用：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token variable"}},[t._v("$topic")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("body")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("clean")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$topic")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("body")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'user_topic_body'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"开始过滤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开始过滤","aria-hidden":"true"}},[this._v("#")]),this._v(" 开始过滤")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("app/Observers/TopicObserver.php")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token php language-php"}},[a("span",{attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),a("span",{attrs:{class:"token package"}},[t._v("App"),a("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Observers")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{attrs:{class:"token package"}},[t._v("App"),a("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Models"),a("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Topic")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{attrs:{class:"token comment"}},[t._v("// creating, created, updating, updated, saving,")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// saved,  deleting, deleted, restoring, restored")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("TopicObserver")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("saving")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Topic "),a("span",{attrs:{class:"token variable"}},[t._v("$topic")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{attrs:{class:"token variable"}},[t._v("$topic")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("body")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("clean")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$topic")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("body")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'user_topic_body'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{attrs:{class:"token variable"}},[t._v("$topic")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("excerpt")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("make_excerpt")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token variable"}},[t._v("$topic")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token property"}},[t._v("body")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(916),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(915),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(914),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(913),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"git-版本控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#git-版本控制","aria-hidden":"true"}},[this._v("#")]),this._v(" Git 版本控制")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("$ "),s("span",{attrs:{class:"token function"}},[this._v("git")]),this._v(" add -A\n$ "),s("span",{attrs:{class:"token function"}},[this._v("git")]),this._v(" commit -m "),s("span",{attrs:{class:"token string"}},[this._v('"Prevent XSS injection"')]),this._v("\n")])])}],e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),a("p",[t._v("目前我们的项目中存在非常严重的 XSS 安全漏洞。作为一个合格的 Web 开发工程师，必须遵循一个安全原则：")]),t._m(1),t._m(2),a("p",[t._v("XSS 也称跨站脚本攻击 (Cross Site Scripting)，恶意攻击者往 Web 页面里插入恶意 JavaScript 代码，当用户浏览该页之时，嵌入其中 Web 里面的 JavaScript 代码会被执行，从而达到恶意攻击用户的目的。")]),t._m(3),a("p",[t._v("有两种方法可以避免 XSS 攻击：")]),t._m(4),a("p",[t._v("Laravel 的 Blade 语法 "),a("code",[t._v(t._s())]),t._v(" 会自动调用 PHP "),a("code",[t._v("htmlspecialchars")]),t._v(" 函数来避免 XSS 攻击。但是因为我们支持 WYSIWYG 编辑器，我们使用的是 "),a("code",[t._v("{!! !!}")]),t._v(" 来打印用户提交的话题内容：")]),t._m(5),t._m(6),t._m(7),a("p",[t._v("编辑器 Simditor 默认为我们的内容提供转义，我们可以使用以下这段代码来测试：")]),t._m(8),t._m(9),a("p",[t._v("提交表单后，渲染结果为安全的、被转义的内容：")]),t._m(10),t._m(11),t._m(12),a("p",[t._v("打开新建话题页面，填入测试代码：")]),t._m(13),a("p",[t._v("点击提交，出现弹框表明我们已经被 XSS 注入，用户可以很轻易地在我们的网页上运行 JavaScript 脚本：")]),t._m(14),a("p",[t._v("接进来我们将着手解决此问题。")]),t._m(15),t._m(16),t._m(17),a("p",[t._v("如配置信息：")]),t._m(18),a("p",[t._v("当用户提交时：")]),t._m(19),a("p",[t._v("会被解析为：")]),t._m(20),a("p",[t._v("以下内容因为未指定会被过滤：")]),t._m(21),t._m(22),t._m(23),t._m(24),a("p",[t._v("使用 Composer 安装：")]),t._m(25),t._m(26),a("p",[t._v("命令行下运行")]),t._m(27),a("p",[t._v("请将配置信息替换为以下:")]),t._m(28),t._m(29),t._m(30),t._m(31),t._m(32),a("p",[t._v("一切准备就绪，现在我们只需要在数据入库前进行过滤即可：")]),t._m(33),t._m(34),a("p",[t._v("浏览器访问话题创建页面，并填入测试内容：")]),t._m(35),a("p",[t._v("提交表单后的结果，只剩下正常内容，并且没有弹框：")]),t._m(36),a("p",[t._v("数据库里可以看到我们提交的 XSS 注入内容已被过滤：")]),t._m(37),a("p",[t._v("至此 XSS 安全漏洞已修复。最后不要忘了为我们的代码去掉注释：")]),t._m(38),t._m(39),a("p",[t._v("下面把代码纳入到版本管理：")]),t._m(40)])},n,!1,null,null,null);s.default=r.exports},913:function(t,s,a){t.exports=a.p+"assets/img/4.5_9.95f1067d.png"},914:function(t,s,a){t.exports=a.p+"assets/img/4.5_8.ceb4a339.png"},915:function(t,s,a){t.exports=a.p+"assets/img/4.5_7.df5868fd.png"},916:function(t,s,a){t.exports=a.p+"assets/img/4.5_6.c32291ed.png"},917:function(t,s,a){t.exports=a.p+"assets/img/4.5_5.31b1169e.png"},918:function(t,s,a){t.exports=a.p+"assets/img/4.5_4.34fa244b.png"},919:function(t,s,a){t.exports=a.p+"assets/img/4.5_3.f9d4d525.png"},920:function(t,s,a){t.exports=a.p+"assets/img/4.5_2.6d4acd9e.png"},921:function(t,s,a){t.exports=a.p+"assets/img/4.5_1.4882e60a.png"}}]);