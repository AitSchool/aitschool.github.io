(window.webpackJsonp=window.webpackJsonp||[]).push([[306],{1396:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"_6-2-站点权限部署"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-站点权限部署","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.2 站点权限部署")]),n("p",[t._v("上一章节中，我们安装和初始化了多角色权限管理方案，接下来我们要将权限控制部署到整个项目中。")]),n("p",[t._v("主要由以下几个地方需要权限控制：")]),n("ul",[n("li",[t._v("拥有 "),n("code",[t._v("manage_contents")]),t._v(" 权限的用户允许管理站点内所有话题和回复，包括编辑和删除动作；")]),n("li",[t._v("Horizon 的控制面板，只有 "),n("code",[t._v("站长")]),t._v(" 才有权限查看。")])]),n("h2",{attrs:{id:"内容管理权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#内容管理权限","aria-hidden":"true"}},[t._v("#")]),t._v(" 内容管理权限")]),n("p",[t._v("拥有 "),n("code",[t._v("manage_contents")]),t._v(" 权限的用户允许管理站点内所有话题和回复，听起来蛮复杂，事实上，得益于 Laravel 授权策略灵活的授权机制，我们只需要几行代码就可以实现。")]),n("p",[t._v("我们将使用授权策略的 "),n("a",{attrs:{href:"https://d.laravel-china.org/docs/5.5/authorization#policy-filters",target:"_blank",rel:"noopener noreferrer"}},[t._v("策略过滤器")]),t._v(" 机制来实现统一授权的目的。我们只需在策略中定义一个 "),n("code",[t._v("before()")]),t._v(" 方法。"),n("code",[t._v("before")]),t._v(" 方法会在策略中其它所有方法之前执行，这样提供了一种全局授权的方案。在 "),n("code",[t._v("before")]),t._v(" 方法中存在三种类型的返回值：")]),n("ul",[n("li",[t._v("返回 "),n("code",[t._v("true")]),t._v(" 是直接通过授权；")]),n("li",[t._v("返回 "),n("code",[t._v("false")]),t._v("，会拒绝用户所有的授权；")]),n("li",[t._v("如果返回的是 null，则通过其它的策略方法来决定授权通过与否。")])]),n("p",[t._v("代码生成器所生成的授权策略，都会统一继承 "),n("code",[t._v("App\\Policies\\Policy")]),t._v(" 基类，这样我们只需要在基类的 "),n("code",[t._v("before()")]),t._v(" 方法里做下角色权限判断即可作用到所有的授权类：")]),n("p",[n("em",[t._v("app/Policies/Policy.php")])]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token php language-php"}},[n("span",{attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),n("span",{attrs:{class:"token package"}},[t._v("App"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Policies")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),n("span",{attrs:{class:"token package"}},[t._v("Illuminate"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Auth"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Access"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("HandlesAuthorization")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Policy")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),n("span",{attrs:{class:"token package"}},[t._v("HandlesAuthorization")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("before")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$ability")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token comment"}},[t._v("// 如果用户拥有管理内容的权限的话，即授权通过")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("can")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'manage_contents'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"用户切换工具-sudo-su"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户切换工具-sudo-su","aria-hidden":"true"}},[t._v("#")]),t._v(" 用户切换工具 sudo-su")]),n("p",[t._v("我们现在有一个问题，加上角色权限判断以后，我们需要切换多个用户来测试，频繁地退出和登录用户是一个费时的事情，接下来我们将使用 "),n("a",{attrs:{href:"https://github.com/viacreative/sudo-su",target:"_blank",rel:"noopener noreferrer"}},[t._v("sudo-su")]),t._v(" 用户切换工具，来提高我们的效率。")]),n("h3",{attrs:{id:"_1-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 安装")]),n("p",[t._v("使用 Composer 安装：")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ composer require "),n("span",{attrs:{class:"token string"}},[t._v('"viacreative/sudo-su:~1.1"')]),t._v("\n")])]),n("h3",{attrs:{id:"_2-添加-provider"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-添加-provider","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 添加 Provider")]),n("p",[n("em",[t._v("app/Providers/AppServiceProvider.php")])]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token php language-php"}},[n("span",{attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("AppServiceProvider")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("ServiceProvider")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("register")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("app")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("isLocal")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token variable"}},[t._v("$this")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token property"}},[t._v("app")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("register")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\\"),n("span",{attrs:{class:"token package"}},[t._v("VIACreative"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("SudoSu"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ServiceProvider")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"_3-发布资源文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-发布资源文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 3. 发布资源文件")]),n("p",[t._v("运行以下命令：")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ php artisan vendor:publish --provider"),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token string"}},[t._v('"VIACreative\\SudoSu\\ServiceProvider"')]),t._v("\n")])]),n("p",[t._v("会生成：")]),n("ul",[n("li",[n("code",[t._v("/public/sudo-su")]),t._v(" 前端 CSS 资源存放文件夹；")]),n("li",[n("code",[t._v("config/sudosu.php")]),t._v(" 配置信息文件；")])]),n("h3",{attrs:{id:"_4-修改配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-修改配置文件","aria-hidden":"true"}},[t._v("#")]),t._v(" 4. 修改配置文件")]),n("p",[n("em",[t._v("config/sudosu.php")])]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token php language-php"}},[n("span",{attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 允许使用的顶级域名")]),t._v("\n    "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'allowed_tlds'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'dev'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'local'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'test'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// 用户模型")]),t._v("\n    "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'user_model'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" App\\"),n("span",{attrs:{class:"token package"}},[t._v("Models"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("User")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("Sudosu 为了避免开发者在生产环境下误开启此功能，在配置选项 "),n("code",[t._v("allowed_tlds")]),t._v(" 里做了域名后缀的限制，tld 为 Top Level Domain 的简写。此处因我们的项目域名为 "),n("code",[t._v("larabbs.test")]),t._v("，故将 "),n("code",[t._v("test")]),t._v(" 域名后缀添加到 "),n("code",[t._v("allowed_tlds")]),t._v(" 数组中。")]),n("h3",{attrs:{id:"_5-模板植入"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-模板植入","aria-hidden":"true"}},[t._v("#")]),t._v(" 5. 模板植入")]),n("p",[t._v("在主要布局模板中的 Scripts 区块上写入模板调用代码：")]),n("p",[n("em",[t._v("resources/views/layouts/app.blade.php")])]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    @"),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token function"}},[t._v("app")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("isLocal")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        @"),n("span",{attrs:{class:"token keyword"}},[t._v("include")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'sudosu::user-selector'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    @"),n("span",{attrs:{class:"token keyword"}},[t._v("endif")]),t._v("\n  \n    "),n("span",{attrs:{class:"token operator"}},[t._v("<")]),n("span",{attrs:{class:"token operator"}},[t._v("!")]),n("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v(" Scripts "),n("span",{attrs:{class:"token operator"}},[t._v("--")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    "),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token double-quoted-string string"}},[t._v("\"{{ asset('js/app.js') }}\"")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token operator"}},[t._v("<")]),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n    @"),n("span",{attrs:{class:"token keyword"}},[t._v("yield")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'scripts'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token operator"}},[t._v("<")]),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("body"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),n("span",{attrs:{class:"token operator"}},[t._v("<")]),n("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("html"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])]),n("p",[t._v("此刻刷新页面，即可看到右下角的用户账号切换按钮：")]),n("p",[n("img",{attrs:{src:a(850),alt:"file"}})]),n("h3",{attrs:{id:"_6-测试下效果"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-测试下效果","aria-hidden":"true"}},[t._v("#")]),t._v(" 6. 测试下效果")]),n("p",[t._v("接下来我们按照以下流程进行测试：")]),n("ol",[n("li",[t._v("登录 ID 为 1，用户 Summer，并访问非 Summer 发布的话题，检测是否能看到删除按钮；")]),n("li",[t._v("登录 ID 为 2 的用户，访问其他人发布的话题，检测是否能看到删除按钮；")]),n("li",[t._v("登录除了 ID 为 1 和 2 的用户，访问其他人发布的话题，检测是否能看到删除按钮。")])]),n("p",[t._v("我们只对 ID 为 1 和 2 的用户做了角色授权，所以其他用户应该没有管理内容的权限：")]),n("p",[n("img",{attrs:{src:a(849),alt:"file"}})]),n("p",[t._v("有了这个账号切换按钮，测试用户权限方便多了。")]),n("h2",{attrs:{id:"horizon-控制面板访问权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#horizon-控制面板访问权限","aria-hidden":"true"}},[t._v("#")]),t._v(" Horizon 控制面板访问权限")]),n("p",[t._v("Horizon 控制面板页面的路由是 "),n("code",[t._v("/horizon")]),t._v(" ，默认只能在 "),n("code",[t._v("local")]),t._v(" 环境中访问仪表盘。我们可以使用 "),n("code",[t._v("Horizon::auth")]),t._v(" 方法定义更具体的访问策略。"),n("code",[t._v("auth")]),t._v(" 方法能够接受一个回调函数，此回调函数需要返回 "),n("code",[t._v("true")]),t._v(" 或 "),n("code",[t._v("false")]),t._v(" ，从而确认当前用户是否有权限访问 Horizon 仪表盘。接下来我们定义 "),n("code",[t._v("/horizon")]),t._v(" 的访问权限，只有 "),n("code",[t._v("站长")]),t._v(" 才有权限查看：")]),n("p",[n("em",[t._v("app/Providers/AuthServiceProvider.php")])]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token php language-php"}},[n("span",{attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("AuthServiceProvider")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("ServiceProvider")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("boot")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token variable"}},[t._v("$this")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("registerPolicies")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        \\"),n("span",{attrs:{class:"token package"}},[t._v("Horizon")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token function"}},[t._v("auth")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$request")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token comment"}},[t._v("// 是否是站长")]),t._v("\n            "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" \\"),n("span",{attrs:{class:"token package"}},[t._v("Auth")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token function"}},[t._v("user")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("hasRole")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'Founder'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),n("p",[t._v("测试一下，我们使用其他用户访问都会返回 404 报错页面，只有当我们使用 ID 为 1 的 Summer 用户访问时，才能顺利显示页面：")]),n("p",[n("img",{attrs:{src:a(848),alt:"file"}})]),n("h2",{attrs:{id:"git-版本控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#git-版本控制","aria-hidden":"true"}},[t._v("#")]),t._v(" Git 版本控制")]),n("p",[t._v("下面把代码纳入到版本管理：")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" add -A\n$ "),n("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),n("span",{attrs:{class:"token string"}},[t._v('"Add manage contents permission and visit horizon dashboard permission"')]),t._v("\n")])])])}],o=a(0),e=Object(o.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);s.default=e.exports},848:function(t,s,a){t.exports=a.p+"assets/img/6.2_3.43a74885.gif"},849:function(t,s,a){t.exports=a.p+"assets/img/6.2_2.888d5888.gif"},850:function(t,s,a){t.exports=a.p+"assets/img/6.2_1.815d67c2.png"}}]);