(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{1308:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"_6-2-支付宝支付"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-支付宝支付","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.2 支付宝支付")]),n("p",[n("img",{attrs:{src:a(283),alt:"file"}})]),n("p",[t._v("本章节将要实现集成支付宝支付。")]),n("h2",{attrs:{id:"获取支付宝沙箱参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#获取支付宝沙箱参数","aria-hidden":"true"}},[t._v("#")]),t._v(" 获取支付宝沙箱参数")]),n("p",[t._v("支付宝有一个沙箱环境，可以让我们不需要拥有真实的商家账号就可以进行支付的开发测试。")]),n("p",[t._v("首先访问 https://openhome.alipay.com/platform/appDaily.htm?tab=info ，用你的支付宝账号登录之后会看到如下界面：")]),n("p",[n("img",{attrs:{src:a(282),alt:"file"}})]),n("p",[t._v("点击 "),n("code",[t._v("设置应用公钥")]),t._v(" 链接：")]),n("p",[n("img",{attrs:{src:a(281),alt:"file"}})]),n("p",[t._v("点击 "),n("code",[t._v("设置应用公钥")]),t._v(" 按钮：")]),n("p",[n("img",{attrs:{src:a(280),alt:"file"}})]),n("p",[t._v("点击 "),n("code",[t._v("查看密钥生成方法")]),t._v(" 链接之后会跳转到一篇文档，里面可以下载 RSA 密钥生成工具，请根据自己的系统下载对应的版本并打开：")]),n("p",[n("img",{attrs:{src:a(279),alt:"file"}})]),n("p",[t._v("如上图，"),n("code",[t._v("密钥格式")]),t._v(" 选择 "),n("code",[t._v("PKCS1")]),t._v("，"),n("code",[t._v("密钥长度")]),t._v(" 选择 "),n("code",[t._v("2048")]),t._v("，然后点击 "),n("code",[t._v("生成密钥")]),t._v(" 按钮。生成完毕之后点击 "),n("code",[t._v("商户应用公钥")]),t._v(" 右侧的 "),n("code",[t._v("复制公钥")]),t._v(" 按钮，将其内容粘贴到刚刚网页上的框中：")]),n("p",[n("img",{attrs:{src:a(278),alt:"file"}})]),n("p",[t._v("点击 "),n("code",[t._v("保存")]),t._v(" 按钮。")]),n("p",[n("img",{attrs:{src:a(277),alt:"file"}})]),n("p",[t._v("再点击页面上的 "),n("code",[t._v("查看支付宝公钥")]),t._v(" 链接：")]),n("p",[n("img",{attrs:{src:a(276),alt:"file"}})]),n("p",[t._v("将这一段公钥复制下来。")]),n("h2",{attrs:{id:"配置参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置参数","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置参数")]),n("p",[t._v("接下来将这些参数放到配置文件中：")]),n("p",[n("em",[t._v("config/pay.php")])]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'app_id'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'你在支付宝沙箱看到的appid'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'ali_public_key'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'支付宝沙箱显示的公钥'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'private_key'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'刚刚生成的私钥'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),n("h2",{attrs:{id:"支付测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#支付测试","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付测试")]),n("p",[t._v("接下来我们要试一下能否正常跳转到支付宝的支付界面，在路由文件中新增一个临时的路由：")]),n("p",[n("em",[t._v("routes/web.php")])]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[t._v("Route"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token function"}},[t._v("get")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'alipay'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("app")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'alipay'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("web")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'out_trade_no'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("time")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'total_amount'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'1'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'subject'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'test subject - 测试'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),n("p",[t._v("然后访问 http://shop.test/alipay")]),n("p",[n("img",{attrs:{src:a(275),alt:"file"}})]),n("p",[t._v("可以看到已经跳转到支付宝的界面，看 URL 是沙箱环境无误。沙箱的支付账户密码可以在刚刚沙箱界面左侧的 "),n("code",[t._v("沙箱账号")]),t._v(" 获得：")]),n("p",[n("img",{attrs:{src:a(274),alt:"file"}})]),n("p",[t._v("在支付页面填入刚刚拿到的账号密码：")]),n("p",[n("img",{attrs:{src:a(273),alt:"file"}})]),n("p",[t._v("登录之后输入支付密码：")]),n("p",[n("img",{attrs:{src:a(272),alt:"file"}})]),n("p",[t._v("点击 "),n("code",[t._v("确认付款")]),t._v(" 按钮：")]),n("p",[n("img",{attrs:{src:a(271),alt:"file"}})]),n("p",[t._v("可以看到付款成功。")]),n("blockquote",[n("p",[t._v("记得把刚刚添加的测试路由删除。")])]),n("h2",{attrs:{id:"git-代码版本控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#git-代码版本控制","aria-hidden":"true"}},[t._v("#")]),t._v(" Git 代码版本控制")]),n("p",[t._v("接着让我们将这些文件加入到版本控制中：")]),n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" add -A\n$ "),n("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m "),n("span",{attrs:{class:"token string"}},[t._v('"集成支付宝"')]),t._v("\n")])])])}],e=a(0),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);s.default=r.exports},271:function(t,s,a){t.exports=a.p+"assets/img/6.2_13.a0ecaba6.png"},272:function(t,s,a){t.exports=a.p+"assets/img/6.2_12.eaed0b16.png"},273:function(t,s,a){t.exports=a.p+"assets/img/6.2_11.0d40f863.png"},274:function(t,s,a){t.exports=a.p+"assets/img/6.2_10.601afadb.png"},275:function(t,s,a){t.exports=a.p+"assets/img/6.2_9.d87ae6db.png"},276:function(t,s,a){t.exports=a.p+"assets/img/6.2_8.ede83ca1.png"},277:function(t,s,a){t.exports=a.p+"assets/img/6.2_7.fde3e06c.png"},278:function(t,s,a){t.exports=a.p+"assets/img/6.2_6.b9aff758.png"},279:function(t,s,a){t.exports=a.p+"assets/img/6.2_5.3e423307.png"},280:function(t,s,a){t.exports=a.p+"assets/img/6.2_4.93a1da85.png"},281:function(t,s,a){t.exports=a.p+"assets/img/6.2_3.08b41d6c.png"},282:function(t,s,a){t.exports=a.p+"assets/img/6.2_2.eda8986d.png"},283:function(t,s,a){t.exports=a.p+"assets/img/6.2_1.0200fabc.png"}}]);