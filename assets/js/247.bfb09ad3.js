(window.webpackJsonp=window.webpackJsonp||[]).push([[247],{1307:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"_7-1-角色权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-角色权限","aria-hidden":"true"}},[t._v("#")]),t._v(" 7.1 角色权限")]),n("p",[t._v("这一节我们主要来实现权限相关的功能，先来了解一下 Larabbs 中的角色权限。")]),n("h3",{attrs:{id:"用户身份"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户身份","aria-hidden":"true"}},[t._v("#")]),t._v(" 用户身份")]),n("p",[t._v("在我们的 LaraBBS 项目里有以下几种用户身份：")]),n("ul",[n("li",[n("strong",[t._v("游客")]),t._v(" 可以随便浏览页面，但是无法发布内容；")]),n("li",[n("strong",[t._v("用户")]),t._v(" 能够发布内容，却只能管理自己的内容；")]),n("li",[n("strong",[t._v("管理员")]),t._v(" 可以管理所有用户的内容，然而不能管理用户；")]),n("li",[n("strong",[t._v("站长")]),t._v(" 拥有最高权限，可以管理所有内容，包括用户。")])]),n("h3",{attrs:{id:"用户权限"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户权限","aria-hidden":"true"}},[t._v("#")]),t._v(" 用户权限")]),n("p",[t._v("根据以上设定，需要设置三个权限")]),n("ul",[n("li",[n("strong",[t._v("manage_contents")]),t._v(" 维护社区的内容")]),n("li",[n("strong",[t._v("manage_users")]),t._v(" 修改用户密码、删除用户等")]),n("li",[n("strong",[t._v("manage_settings")]),t._v(" 可以在后台管理站点相关的设置，如 SEO 设置、联系邮箱等")])]),n("h3",{attrs:{id:"用户角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户角色","aria-hidden":"true"}},[t._v("#")]),t._v(" 用户角色")]),n("p",[t._v("设置两个角色")]),n("ul",[n("li",[n("strong",[t._v("管理员 Maintainer")]),t._v("  拥有 manage_contents 权限")]),n("li",[n("strong",[t._v("站长 Founder")]),t._v("  拥有 manage_contents， manage_users， manage_settings 权限")])]),n("p",[t._v("游客和用户没有角色；将 1 号用户指派为『站长』拥有所有权限；将 2 号用户设置为管理员，拥有 "),n("code",[t._v("manage_contents")]),t._v(" 权限，帮助维护社区内容。")]),n("h2",{attrs:{id:"客户端判断逻辑"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#客户端判断逻辑","aria-hidden":"true"}},[t._v("#")]),t._v(" 客户端判断逻辑")]),n("p",[t._v("客户端（iOS 或者 Android）的界面显示上，需要根据用户的权限以及用户与资源的关系，显示不同的内容。以下将以 Web 端为例子来讲解。")]),n("p",[t._v("比如拥有  "),n("code",[t._v("manage_contents")]),t._v(" 管理内容权限的用户，可以修改所有的话题和评论。")]),n("p",[t._v("以某个普通用户登录为例，可以看到该用户只能编辑、删除自己发布的话题。")]),n("p",[n("img",{attrs:{src:a(644),alt:"file"}})]),n("p",[n("img",{attrs:{src:a(643),alt:"file"}})]),n("p",[t._v("再以 1 号用户 Summer 登录，查看其它用户发布的帖子，依然可以编辑、删除。\n"),n("img",{attrs:{src:a(642),alt:"file"}})]),n("p",[t._v("网页中，我们是通过 Blade 的 can 命令进行判断的")]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[t._v("@"),n("span",{attrs:{class:"token function"}},[t._v("can")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'update'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$topic")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),n("p",[t._v("看一下判断逻辑，在 "),n("code",[t._v("App\\Policies\\TopicPolicy")]),t._v(" 中")]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token php language-php"}},[n("span",{attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),n("span",{attrs:{class:"token package"}},[t._v("App"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Policies")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),n("span",{attrs:{class:"token package"}},[t._v("App"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Models"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("User")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),n("span",{attrs:{class:"token package"}},[t._v("App"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Models"),n("span",{attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Topic")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("TopicPolicy")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Policy")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("update")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User "),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Topic "),n("span",{attrs:{class:"token variable"}},[t._v("$topic")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("isAuthorOf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$topic")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("destroy")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("User "),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Topic "),n("span",{attrs:{class:"token variable"}},[t._v("$topic")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("isAuthorOf")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$topic")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("App\\Policies\\Policy")]),t._v(" 基类中的 "),n("code",[t._v("before")]),t._v(" 方法会优先执行")]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("before")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$ability")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 如果用户拥有管理内容的权限的话，即授权通过")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("can")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'manage_contents'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),n("p",[t._v("最终的判断逻辑是，如果用户拥有 "),n("code",[t._v("manage_contents")]),t._v(" 权限，或者是话题的发布者，可以编辑某个话题。")]),n("p",[t._v("对于客户端 APP 来说，执行的逻辑是相同的，只不过用户的权限是通过接口请求来的。下一章节中我们将编写『权限数据接口』，客户端在获取到权限数据后，即可在客户端完成权限的控制。")])])}],e=a(0),o=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);s.default=o.exports},642:function(t,s,a){t.exports=a.p+"assets/img/7.1_3.ad654911.png"},643:function(t,s,a){t.exports=a.p+"assets/img/7.1_2.7b9d58a3.png"},644:function(t,s,a){t.exports=a.p+"assets/img/7.1_1.4f24486a.png"}}]);