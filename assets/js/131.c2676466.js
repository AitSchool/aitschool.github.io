(window.webpackJsonp=window.webpackJsonp||[]).push([[131],{112:function(a,s,e){a.exports=e.p+"assets/img/9.3_7.49bd40af.png"},113:function(a,s,e){a.exports=e.p+"assets/img/9.3_6.907ca263.png"},114:function(a,s,e){a.exports=e.p+"assets/img/9.3_5.c16d415b.png"},115:function(a,s,e){a.exports=e.p+"assets/img/9.3_4.14b6b1e3.png"},116:function(a,s,e){a.exports=e.p+"assets/img/9.3_3.67adf4ba.png"},117:function(a,s,e){a.exports=e.p+"assets/img/9.3_2.07e9b3db.png"},118:function(a,s,e){a.exports=e.p+"assets/img/9.3_1.c5a9d3ac.png"},1380:function(a,s,e){"use strict";e.r(s);var t=[function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("div",{staticClass:"content"},[t("h1",{attrs:{id:"_9-3-备份管理后台数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-3-备份管理后台数据","aria-hidden":"true"}},[a._v("#")]),a._v(" 9.3 备份管理后台数据")]),t("p",[a._v("我们在管理后台配置的菜单、权限都是保存在数据库里的，没有办法像代码文件一样提交到 Git 版本库中，因此我们需要把开发环境中配置好的后台信息导出成 SQL 文件，然后把 SQL 文件提交到 Git 版本库中。")]),t("h2",{attrs:{id:"_1-确定要备份的数据表"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-确定要备份的数据表","aria-hidden":"true"}},[a._v("#")]),a._v(" 1. 确定要备份的数据表")]),t("p",[a._v("首先我们需要明确要备份哪些表里的数据，打开数据库管理工具，看看数据库里有哪些与管理后台相关的表：")]),t("p",[t("img",{attrs:{src:e(118),alt:"file"}})]),t("p",[a._v("红框中以 "),t("code",[a._v("admin_")]),a._v(" 开头的表就是 Laravel-Admin 使用的表，从表名我们可以判断出各自的作用：")]),t("ul",[t("li",[t("code",[a._v("admin_menu")]),a._v(" —— 管理后台的菜单；")]),t("li",[t("code",[a._v("admin_operation_log")]),a._v(" —— 管理后台操作日志；")]),t("li",[t("code",[a._v("admin_permissions")]),a._v(" —— 权限列表；")]),t("li",[t("code",[a._v("admin_role_menu")]),a._v(" —— 角色与菜单的关联关系；")]),t("li",[t("code",[a._v("admin_role_permissions")]),a._v(" —— 角色与权限的关联关系；")]),t("li",[t("code",[a._v("admin_role_users")]),a._v(" —— 管理员与角色的关联关系；")]),t("li",[t("code",[a._v("admin_roles")]),a._v(" —— 角色列表；")]),t("li",[t("code",[a._v("admin_user_permissions")]),a._v(" —— 管理员与权限的关联关系；")]),t("li",[t("code",[a._v("admin_users")]),a._v(" —— 管理员列表。")])]),t("p",[a._v("可以看出除了 "),t("code",[a._v("admin_operation_log")]),a._v(" 操作日志表之外，别的表都是需要导出的。")]),t("h2",{attrs:{id:"_2-执行导出"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-执行导出","aria-hidden":"true"}},[a._v("#")]),a._v(" 2. 执行导出")]),t("p",[a._v("因为这是一个一次性的工作，没有必要专门写代码来处理导入和导出，所以我们选择直接用 "),t("code",[a._v("mysqldump")]),a._v(" 这个命令行程序来导出数据库中的数据，从成本上来说比较合适：")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ mysqldump -t laravel-shop admin_menu admin_permissions admin_role_menu admin_role_permissions admin_role_users admin_roles admin_user_permissions admin_users "),t("span",{attrs:{class:"token operator"}},[a._v(">")]),a._v(" database/admin.sql\n")])]),t("p",[a._v("命令解析：")]),t("ul",[t("li",[t("code",[a._v("-t")]),a._v(" 选项代表不导出数据表结构，这些表的结构我们会通过 Laravel 的 migration 迁移文件来创建；")]),t("li",[t("code",[a._v("laravel-shop")]),a._v(" 代表我们要导出的数据库名称，后面则是要导出的表列表；")]),t("li",[t("code",[a._v("> database/admin.sql")]),a._v(" 把导出的内容保存到 "),t("code",[a._v("database/admin.sql")]),a._v(" 文件中。")])]),t("blockquote",[t("p",[a._v("在 Homestead 环境中我们执行 Mysql 相关的命令都不需要账号密码，因为 Homestead 都已经帮我们配置好了。在线上执行 Mysql 命令时则需要在命令行里通过 -u 和 -p 参数指明账号密码，如： "),t("code",[a._v("mysqldump -uroot -p123456 laravel-shop > database/admin.sql")])])]),t("p",[t("img",{attrs:{src:e(117),alt:"file"}})]),t("p",[a._v("现在看看 "),t("code",[a._v("database/admin.sql")]),a._v(" 文件的内容：")]),t("p",[t("img",{attrs:{src:e(116),alt:"file"}})]),t("p",[t("img",{attrs:{src:e(115),alt:"file"}})]),t("p",[a._v("可以看到我们需要导出的数据都在里面。")]),t("h2",{attrs:{id:"_3-测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-测试","aria-hidden":"true"}},[a._v("#")]),a._v(" 3. 测试")]),t("p",[a._v("接下来我们要测试一下这份导出的 SQL 能否正常使用。")]),t("p",[a._v("首先我们用 Laravel 的 "),t("code",[a._v("migrate:fresh")]),a._v(" 命令将数据库全部清空并重新执行 migrate：")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ php artisan migrate:fresh\n")])]),t("p",[t("img",{attrs:{src:e(114),alt:"file"}})]),t("p",[a._v("接着我们通过 Mysql 命令导入 SQL：")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ mysql laravel-shop "),t("span",{attrs:{class:"token operator"}},[a._v("<")]),a._v(" database/admin.sql\n")])]),t("p",[t("img",{attrs:{src:e(113),alt:"file"}})]),t("p",[a._v("没有任何提示，我们到数据库管理软件里看看：")]),t("p",[t("img",{attrs:{src:e(112),alt:"file"}})]),t("p",[a._v("可以看到数据已经导入成功了。")]),t("h2",{attrs:{id:"git-代码版本控制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#git-代码版本控制","aria-hidden":"true"}},[a._v("#")]),a._v(" Git 代码版本控制")]),t("p",[a._v("接着让我们将这个 SQL 文件加入到版本控制中：")]),t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{attrs:{class:"token function"}},[a._v("git")]),a._v(" add -A\n$ "),t("span",{attrs:{class:"token function"}},[a._v("git")]),a._v(" commit -m "),t("span",{attrs:{class:"token string"}},[a._v('"管理后台 SQL 文件"')]),a._v("\n")])])])}],i=e(0),r=Object(i.a)({},function(){this.$createElement;this._self._c;return this._m(0)},t,!1,null,null,null);s.default=r.exports}}]);