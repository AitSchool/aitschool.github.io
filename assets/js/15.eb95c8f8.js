(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{1698:function(t,s,a){"use strict";a.r(s);var n=a(0),o=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"node-js-buffer-二进制处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-js-buffer-二进制处理","aria-hidden":"true"}},[t._v("#")]),t._v(" Node.js Buffer 二进制处理")]),a("p",[t._v("JavaScript 是为浏览器设计的，能很好处理 unicode 编码的字符串，但对二机制或非 unicode 编码的数据显得无能为力。Node.js 扩展了 JavaScript 为二级制数据处理提供了 Buffer 类，可以像其他程序语言一样处理各种类型的数据。在 Node.js 中, Buffer 类用来创建一个专门存放二进制数据的缓存区，类似于一个整数数组，对应于 V8 堆内存之外的一块原始内存。")]),a("p",[t._v("使用场景：")]),a("p",[t._v("通过 Buffer 我们可以把图片转换成 base64 字符串，可以实现手机 APP 和服务器之间 JSON 数据的图片信息传递。还有在一些常用系统中，例如考勤机生产的 Excel 文件，我们也可以通过 Buffer 来提取内容，通过 JSON 发送到服务器保存到数据库存档。")]),a("p",[t._v("内存限制：")]),a("p",[t._v("Node.js 使用了本来运行在浏览器的 V8 引擎，引擎在设计之初只运行在浏览器中，默认只能使用到系统一部分内存，64位系统下位 1.4 GB，32 位系统下位 0.7 GB。Node.js 对内存的使用可以通过参数来解除。Node.js 之所以可以使用 Buffer 读取超过 V8 内存限制的大文件，原因是 Buffer 对象不同于其他对象，它不经过 V8 的内存分配机制，它使用的是系统内存。")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("node "),a("span",{attrs:{class:"token operator"}},[t._v("--")]),t._v("max"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("old"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("space"),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("size"),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token number"}},[t._v("2000")]),t._v(" app"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js "),a("span",{attrs:{class:"token comment"}},[t._v("// 单位为 MB")]),t._v("\n")])]),a("h2",{attrs:{id:"buffer-创建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#buffer-创建","aria-hidden":"true"}},[t._v("#")]),t._v(" Buffer 创建")]),a("ul",[a("li",[t._v("创建长度为 10 字节的 Buffer 实例：")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buf "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("alloc")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("10")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("ul",[a("li",[t._v("通过给定的数组创建 Buffer 实例：")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buf "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token number"}},[t._v("10")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("300")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'Hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("ul",[a("li",[t._v("通过一个字符串来创建 Buffer 实例：")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buf "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'Hello world'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token string"}},[t._v("'utf-8'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("ul",[a("li",[t._v("合并 Buffer 字符集")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buf_1 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'hello'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buf_2 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'world'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buf_3 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("concat")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("buf_1"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" buf_2"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("h2",{attrs:{id:"缓存区写入和读取"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存区写入和读取","aria-hidden":"true"}},[t._v("#")]),t._v(" 缓存区写入和读取")]),a("ul",[a("li",[t._v("buf.write(string [,offset] [,length] [,encoding])")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buf "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("alloc")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("10")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nbuf"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("write")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'你好'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("ul",[a("li",[t._v("buf.toString([encoding] [,start] [,end])")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" buf "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("alloc")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("10")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nbuf"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("write")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'你好'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token comment"}},[t._v("// 在默认情况下字符集编码为 utf8，utf8 一个汉子占用 3 个字节。")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" bufStr "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" buf"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("toString")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'utf-8'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("3")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{attrs:{class:"token number"}},[t._v("6")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// '好'")]),t._v("\n")])]),a("ul",[a("li",[t._v("buf.toJSON() 返回 JSON 格式的 Buffer 数据对象，包含 type 和 data。")])]),a("h2",{attrs:{id:"安全构造"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安全构造","aria-hidden":"true"}},[t._v("#")]),t._v(" 安全构造")]),a("ul",[a("li",[t._v("安全构造 Buffer：缓存区的内存先被格式化，然后才使用。使用默认数字 0 填充缓存区。")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("alloc")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("size"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nBuffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("String"),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("encoding"),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("ul",[a("li",[t._v("不安全构造 Buffer：缓存区没有格式化就直接拿来使用，容易导致运算错误")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{attrs:{class:"token class-name"}},[t._v("Buffer")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("size"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("h2",{attrs:{id:"支付多种字符集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#支付多种字符集","aria-hidden":"true"}},[t._v("#")]),t._v(" 支付多种字符集")]),a("p",[t._v("Buffer 在保存数据和输出数据支持多种字符集")]),a("ul",[a("li",[t._v("ASCII")]),a("li",[t._v("UTF-8")]),a("li",[t._v("UTF16LE")]),a("li",[t._v("BASE64")]),a("li",[t._v("BINARY (2进制)")]),a("li",[t._v("HEX (16进制)")])]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" s1 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"hello world"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"HEX"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 用 HEX 写入字符集")]),t._v("\n"),a("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" s2 "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token keyword"}},[t._v("from")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"hello world"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("toString")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v('"BASE64"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{attrs:{class:"token comment"}},[t._v("// 以 BASE64 进行输出")]),t._v("\n")])])])}],!1,null,null,null);s.default=o.exports}}]);