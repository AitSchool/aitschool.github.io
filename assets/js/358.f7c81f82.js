(window.webpackJsonp=window.webpackJsonp||[]).push([[358],{1075:function(t,a,s){t.exports=s.p+"assets/img/7.4_2.71feefe7.png"},1076:function(t,a,s){t.exports=s.p+"assets/img/7.4_1.622dd007.png"},1473:function(t,a,s){"use strict";s.r(a);var n=[function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("div",{staticClass:"content"},[n("h1",{attrs:{id:"_7-4-邮件通知"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-邮件通知","aria-hidden":"true"}},[t._v("#")]),t._v(" 7.4 邮件通知")]),n("h2",{attrs:{id:"邮件通知"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#邮件通知","aria-hidden":"true"}},[t._v("#")]),t._v(" 邮件通知")]),n("p",[t._v("本章节我们将为『话题有新回复』通知新增『邮件通知频道』，当话题被回复时，作者可以收到一份 Email 邮件通知。Laravel 的通知系统默认支持邮件频道的通知方式，我们只需要稍作配置即可。")]),n("p",[t._v("Laravel 支持多种邮件驱动，包括 smtp、Mailgun、Maildrill、Amazon SES、mail 和 sendmail。Mailgun 、 Amazon SES 、Maildrill 都是第三方邮件服务（"),n("a",{attrs:{href:"http://d.laravel-china.org/docs/5.5/mail",target:"_blank",rel:"noopener noreferrer"}},[t._v("Laravel 文档")]),t._v(" ）。mail 驱动使用 PHP 提供的 mail 函数。sendmail 驱动通过 Sendmail/Postfix（Linux）提供的命令发送邮件，smtp 驱动使用支持 ESMTP 的 SMTP 服务器发送邮件。mail 不安全，sendmail 需要安装配置 Sendmail/Postfix，并且信用不高，很容易被当成垃圾邮件，第三方服务的信用是最高的，商业软件推荐使用。")]),n("p",[t._v("本章节以 QQ 邮箱为例，我们将开启 QQ 的 SMTP 功能，并配置项目的 SMTP 邮件发送功能。其他邮箱的配置基本大致相同。")]),n("h2",{attrs:{id:"_1-开启-qq-邮箱的-smtp-支持"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-开启-qq-邮箱的-smtp-支持","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 开启 QQ 邮箱的 SMTP 支持")]),n("p",[t._v("首先我们需要在 QQ 邮箱的账号设置里开启 POP3 和 SMTP 服务。具体请查看 "),n("a",{attrs:{href:"http://service.mail.qq.com/cgi-bin/help?subtype=1&id=28&no=166",target:"_blank",rel:"noopener noreferrer"}},[t._v("如何打开POP3/SMTP/IMAP功能？")]),t._v(" 。")]),n("p",[t._v("只需要开启以下：")]),n("p",[n("img",{attrs:{src:s(1076),alt:"file"}})]),n("p",[t._v("复制方框里的『授权码』，授权码将作为我们的密码使用：")]),n("p",[n("img",{attrs:{src:s(1075),alt:"file"}})]),n("h2",{attrs:{id:"_2-邮箱发送配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-邮箱发送配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 2. 邮箱发送配置")]),n("p",[t._v("Laravel 中邮箱发送的配置存放于 "),n("code",[t._v("config/mail.php")]),t._v(" 中。不过 "),n("code",[t._v("mail.php")]),t._v(" 中我们所需的配置，都可以通过 "),n("code",[t._v(".env")]),t._v(" 来配置。作为最佳实践，我们优先选择通过环境变量来配置：")]),n("p",[n("em",[t._v(".env")])]),n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v(".\n.\n.\nMAIL_DRIVER=smtp\nMAIL_HOST=smtp.qq.com\nMAIL_PORT=25\nMAIL_USERNAME=xxxxxxxxxxxxxx@qq.com\nMAIL_PASSWORD=xxxxxxxxx\nMAIL_ENCRYPTION=tls\nMAIL_FROM_ADDRESS=xxxxxxxxxxxxxx@qq.com\nMAIL_FROM_NAME=SampleApp\n.\n.\n.\n")])]),n("p",[t._v("选项讲解：")]),n("ol",[n("li",[t._v("MAIL_DRIVER=smtp —— 使用支持 ESMTP 的 SMTP 服务器发送邮件；")]),n("li",[t._v("MAIL_HOST=smtp.qq.com —— QQ 邮箱的 SMTP 服务器地址，必须为此值；")]),n("li",[t._v("MAIL_PORT=25 —— QQ 邮箱的 SMTP 服务器端口，必须为此值；")]),n("li",[t._v("MAIL_USERNAME=xxxxxxxxxxxxxx@qq.com —— 请将此值换为你的 QQ + "),n("code",[t._v("@qq.com")]),t._v("；")]),n("li",[t._v("MAIL_PASSWORD=xxxxxxxxx —— 密码是我们第一步拿到的授权码；")]),n("li",[t._v("MAIL_ENCRYPTION=tls —— 加密类型，选项 null 表示不使用任何加密，其他选项还有 ssl，这里我们使用 tls 即可。")]),n("li",[t._v("MAIL_FROM_ADDRESS=xxxxxxxxxxxxxx@qq.com —— 此值必须同 MAIL_USERNAME 一致；")]),n("li",[t._v("MAIL_FROM_NAME=SampleApp —— 用来作为邮件的发送者名称。")])]),n("h2",{attrs:{id:"历史遗留问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#历史遗留问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 历史遗留问题")]),n("p",[t._v("还记得 "),n("strong",[t._v("账户激活")]),t._v(" 一节的邮件发送逻辑吗？现在我们已经在环境配置文件完善了邮件的发送配置，因此不再需要使用 "),n("code",[t._v("from")]),t._v(" 方法：")]),n("p",[n("em",[t._v("app/Http/Controllers/UsersController.php")])]),n("pre",{pre:!0,attrs:{class:"language-php"}},[n("code",[n("span",{attrs:{class:"token php language-php"}},[n("span",{attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("UsersController")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("extends")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Controller")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("protected")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("sendEmailConfirmationTo")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{attrs:{class:"token variable"}},[t._v("$view")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'emails.confirm'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token variable"}},[t._v("$data")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("compact")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'user'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token variable"}},[t._v("$to")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$user")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token property"}},[t._v("email")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token variable"}},[t._v("$subject")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token double-quoted-string string"}},[t._v('"感谢注册 Sample 应用！请确认你的邮箱。"')]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        Mail"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),n("span",{attrs:{class:"token function"}},[t._v("send")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$view")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$data")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$message")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$to")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token variable"}},[t._v("$subject")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{attrs:{class:"token variable"}},[t._v("$message")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("to")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$to")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token operator"}},[t._v("-")]),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token function"}},[t._v("subject")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token variable"}},[t._v("$subject")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}],e=s(0),r=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},n,!1,null,null,null);a.default=r.exports}}]);