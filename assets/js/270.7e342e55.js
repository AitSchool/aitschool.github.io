(window.webpackJsonp=window.webpackJsonp||[]).push([[270],{1342:function(t,s,a){"use strict";a.r(s);var e=[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"_3-2-开发者账户"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-开发者账户","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.2 开发者账户")]),e("p",[t._v("我们拿最常见的微信登录来完成下面的课程，但是对于普通用户来说，微信不支持个人开发者申请微信登录，即便申请到了，也不方便的测试。不过没有关系，OAuth 2.0 的流程是固定的，我们最终需要处理的都是通过授权码，获取 "),e("code",[t._v("access_token")]),t._v("，从而得到用户数据，好在微信公众平台为我们提供了接口测试账号，我们可以利用这个测试账号，通过网页授权，模拟学习整个流程。")]),e("h3",{attrs:{id:"微信公众平台测试账号"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#微信公众平台测试账号","aria-hidden":"true"}},[t._v("#")]),t._v(" 微信公众平台测试账号")]),e("p",[t._v("申请公众平台测试账号十分方便，直接通过微信登录即可，"),e("a",{attrs:{href:"https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login",target:"_blank",rel:"noopener noreferrer"}},[t._v("登录地址")])]),e("p",[e("img",{attrs:{src:a(725),alt:"file"}})]),e("p",[t._v("登录后我们可以看到 "),e("code",[t._v("appId")]),t._v(" 和 "),e("code",[t._v("appsecret")]),t._v("。")]),e("p",[e("img",{attrs:{src:a(724),alt:"file"}})]),e("p",[t._v("我们需要关注自己的测试公众号，只有关注了测试公众号的用户，才可以进行授权操作，微信扫描 "),e("code",[t._v("测试号二维码")]),t._v(" 即可。")]),e("p",[e("img",{attrs:{src:a(723),alt:"file"}})]),e("p",[t._v("可以在右侧用户列表中看到已经关注的用户。")]),e("p",[e("img",{attrs:{src:a(722),alt:"file"}})]),e("p",[t._v("在下面的 "),e("code",[t._v("体验接口权限表")]),t._v(" 中我们可以找到 "),e("code",[t._v("网页授权获取用户基本信息")]),t._v("，点击最后的修改按钮")]),e("p",[e("img",{attrs:{src:a(721),alt:"file"}})]),e("p",[t._v("填入 "),e("code",[t._v("larabbs.test")]),t._v("，这个是 OAuth 流程中需要提前配置好的回调域名，回调地址必须在这个域名下。")]),e("h3",{attrs:{id:"测试-oauth-流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试-oauth-流程","aria-hidden":"true"}},[t._v("#")]),t._v(" 测试 OAuth 流程")]),e("p",[t._v("因为是公众平台测试账号，所以我们首先需要下载 "),e("a",{attrs:{href:"https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1455784140",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信web开发者工具")]),t._v("，方便我们接下来的调试。\n"),e("img",{attrs:{src:a(720),alt:"file"}})]),e("p",[t._v("打开开发者工具，扫码登录，选择公众号项目\n"),e("img",{attrs:{src:a(719),alt:"file"}})]),e("p",[t._v("打开后我们看到如下界面\n"),e("img",{attrs:{src:a(718),alt:"file"}})]),e("p",[t._v("接下来，我们尝试一下 "),e("a",{attrs:{href:"https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421140842",target:"_blank",rel:"noopener noreferrer"}},[t._v("微信网页授权")]),t._v(" 的流程。下面这个链接为微信发起 OAuth 的跳转地址。")]),e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("https://open.weixin.qq.com/connect/oauth2/authorize?appid"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("APPID"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("redirect_uri"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("REDIRECT_URI"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("response_type"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("code"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("scope"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("SCOPE"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("state"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("STATE"),e("span",{attrs:{class:"token comment"}},[t._v("#wechat_redirect")]),t._v("\n")])]),e("p",[t._v("注意链接中有几个变量需要替换")]),e("ul",[e("li",[t._v("APPID  测试账号中的"),e("code",[t._v("appID")]),t._v("，填写自己账号的 "),e("code",[t._v("appID")])]),e("li",[t._v("REDIRECT_URI   用户同意授权后的回调地址，填写 "),e("code",[t._v("http://larabbs.test")])]),e("li",[t._v("SCOPE 应用授权作用域，填写 "),e("code",[t._v("snsapi_userinfo")])]),e("li",[t._v("STATE 随机参数，可以不填，我们保持 "),e("code",[t._v("STATE")]),t._v(" 即可。")])]),e("p",[t._v("替换后我们得到的链接类似")]),e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("https://open.weixin.qq.com/connect/oauth2/authorize?appid"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("wxe0ba316xxxxxxx"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("redirect_uri"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("http://larabbs.test"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("response_type"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("code"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("scope"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("snsapi_userinfo"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("state"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("STATE"),e("span",{attrs:{class:"token comment"}},[t._v("#wechat_redirect")]),t._v("\n")])]),e("p",[t._v("在开发者工具中，访问该链接，可以看到微信授权页面\n"),e("img",{attrs:{src:a(717),alt:"file"}})]),e("p",[t._v("点击确认登录\n"),e("img",{attrs:{src:a(716),alt:"file"}})]),e("p",[t._v("我们成功的跳转回了 "),e("code",[t._v("REDIRECT_URI")]),t._v("，注意url中可以看到code参数。好了我们已经完成了 OAuth 流程中获取授权码的步骤。")]),e("p",[t._v("请求以下链接获取 access_token：")]),e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("https://api.weixin.qq.com/sns/oauth2/access_token?appid"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("APPID"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("secret"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("SECRET"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("code"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("CODE"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("grant_type"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("authorization_code\n")])]),e("p",[t._v("需要替换的变量")]),e("ul",[e("li",[t._v("APPID  测试账号中的"),e("code",[t._v("appID")]),t._v("，填写自己账号的 "),e("code",[t._v("appID")])]),e("li",[t._v("SECRET  测试账号中的"),e("code",[t._v("secret")]),t._v("，填写自己账号的 "),e("code",[t._v("secret")])]),e("li",[t._v("code  上一步获取的 code")])]),e("p",[t._v("替换后的链接如下")]),e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("https://api.weixin.qq.com/sns/oauth2/access_token?appid"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("wx353901f6xxxxx"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("secret"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("d4624c36b6795d1d99dxxxxxxxx"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("code"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("0813AoG21n9C2O1yfxH21t4nG213AoGH"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("grant_type"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("authorization_code\n")])]),e("p",[t._v("使用 PostMan 访问该链接，获取到了 "),e("code",[t._v("access_token")]),t._v("，注意微信同时返回了 "),e("code",[t._v("open_id")]),t._v("，微信"),e("code",[t._v("access_token")]),t._v(" 和 "),e("code",[t._v("open_id")]),t._v(" 一起请求用户信息。\n"),e("img",{attrs:{src:a(715),alt:"file"}})]),e("p",[t._v("通过 "),e("code",[t._v("access_token")]),t._v("获取个人信息")]),e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("https://api.weixin.qq.com/sns/userinfo?access_token"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("ACCESS_TOKEN"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("openid"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("OPENID"),e("span",{attrs:{class:"token operator"}},[t._v("&")]),t._v("lang"),e("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v("zh_CN\n")])]),e("p",[t._v("替换链接中的 "),e("code",[t._v("ACCESS_TOKEN")]),t._v(" 和 "),e("code",[t._v("OPENID")]),t._v("，使用 PostMan 访问\n"),e("img",{attrs:{src:a(714),alt:"file"}})]),e("p",[t._v("通过上面的测试流程，尝试将微信登录带入整个流程，相信大家对于 OAuth 流程有了更加深入的认识。")])])}],r=a(0),o=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},e,!1,null,null,null);s.default=o.exports},714:function(t,s,a){t.exports=a.p+"assets/img/3.2_12.bc26bdd8.png"},715:function(t,s,a){t.exports=a.p+"assets/img/3.2_11.c6b8d0a7.png"},716:function(t,s,a){t.exports=a.p+"assets/img/3.2_10.2fa3f4c2.png"},717:function(t,s,a){t.exports=a.p+"assets/img/3.2_9.45977a59.png"},718:function(t,s,a){t.exports=a.p+"assets/img/3.2_8.24cacb04.png"},719:function(t,s,a){t.exports=a.p+"assets/img/3.2_7.4fc52e9b.png"},720:function(t,s,a){t.exports=a.p+"assets/img/3.2_6.a7123a11.png"},721:function(t,s,a){t.exports=a.p+"assets/img/3.2_5.8530f47d.png"},722:function(t,s,a){t.exports=a.p+"assets/img/3.2_4.92cca095.png"},723:function(t,s,a){t.exports=a.p+"assets/img/3.2_3.e36d6f8d.png"},724:function(t,s,a){t.exports=a.p+"assets/img/3.2_2.b021fa09.png"},725:function(t,s,a){t.exports=a.p+"assets/img/3.2_1.fcd732cd.png"}}]);