(window.webpackJsonp=window.webpackJsonp||[]).push([[130],{111:function(t,s,a){t.exports=a.p+"assets/img/9.4_1.0392422d.png"},1383:function(t,s,a){"use strict";a.r(s);var n=[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"_9-4-系统安全"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-4-系统安全","aria-hidden":"true"}},[this._v("#")]),this._v(" 9.4 系统安全")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_1-sql-注入漏洞"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-sql-注入漏洞","aria-hidden":"true"}},[this._v("#")]),this._v(" 1. SQL 注入漏洞")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("SQL 注入是最古老、最流行同样也是危害最大的漏洞之一，这个漏洞的核心就一句话：将"),s("strong",[this._v("未经过滤")]),this._v("的用户输入"),s("strong",[this._v("拼接")]),this._v("到 SQL 语句中。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token variable"}},[t._v("$product")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("DB")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("select")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token double-quoted-string string"}},[t._v('"select * from products where id = \'"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'id'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token double-quoted-string string"}},[t._v('"\'"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这个时候用户提交的 "),s("code",[this._v("id")]),this._v(" 如果是 "),s("code",[this._v("1 and 1 = 2")]),this._v("，那么最终被执行的 SQL 就是")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[t._v("select "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" from products where id "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("但仅仅是这样感觉好像没有什么危害，那这个时候攻击者提交的 "),s("code",[this._v("id")]),this._v(" 参数变成了：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("and")]),t._v(" exists "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" from admins where name "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'admin'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[t._v("select "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" from products where id "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("and")]),t._v(" exists "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" from admins where name "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'admin'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("假如攻击者看到了正常的商品页面，那就说明这个网站存在一个名为 "),s("code",[this._v("admin")]),this._v(" 的管理员。接着请求：")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("and")]),t._v(" exists "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("select "),a("span",{attrs:{class:"token operator"}},[t._v("*")]),t._v(" from admins where name "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'admin'")]),t._v(" "),a("span",{attrs:{class:"token keyword"}},[t._v("and")]),t._v(" "),a("span",{attrs:{class:"token function"}},[t._v("len")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("password"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("32")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这样根据页面是否展示商品信息就能判断出 "),s("code",[this._v("admin")]),this._v(" 这个管理员在数据库中的密码是否为 32 位。这样就可以一步一步来验证出管理员的密码。现在有很多自动化的 SQL 注入软件，可以用很短的时间就把管理员的数据查询出来。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("使用 Prepared Statement + 参数绑定")]),s("li",[this._v("绝对不手动拼接 SQL")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-php"}},[s("code",[this._v("select "),s("span",{attrs:{class:"token operator"}},[this._v("*")]),this._v(" from products where id "),s("span",{attrs:{class:"token operator"}},[this._v("=")]),this._v(" "),s("span",{attrs:{class:"token operator"}},[this._v("?")]),this._v("\n")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("p",[t._v("然后再传入参数："),a("code",[t._v("1 and 1 = 1")]),t._v("，这个时候数据库会严格地去查找对应 ID = "),a("code",[t._v("1 and 1 = 1")]),t._v(" 的商品，而不是把 "),a("code",[t._v("and 1 = 1")]),t._v(" 当做查询条件，所以即使 "),a("code",[t._v("1 = 1")]),t._v(" 成立，数据库仍然返回空。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token variable"}},[t._v("$product")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("DB")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token function"}},[t._v("select")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token double-quoted-string string"}},[t._v('"select * from products where id = \'"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token variable"}},[t._v("$_GET")]),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'id'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token double-quoted-string string"}},[t._v('"\'"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_2-xss-漏洞"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-xss-漏洞","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. XSS 漏洞")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("XSS 是与 SQL 注入齐名的漏洞，也可以用一句话来描述其核心：将"),s("strong",[this._v("未经过滤")]),this._v("的用户输入"),s("strong",[this._v("原样输出")]),this._v("到网页中。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),a("span",{attrs:{class:"token function"}},[t._v("alert")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token number"}},[t._v("123")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("用户昵称")]),s("li",[this._v("收货地址的所有字段")]),s("li",[this._v("下单时的备注字段")]),s("li",[this._v("商品评价字段")]),s("li",[this._v("申请退款理由")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这些字段我们并没有做任何的过滤，现在核心是看看我们是否"),s("strong",[this._v("原样输出")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所以排查方式很简单，搜索 "),s("code",[this._v("resources/views")]),this._v(" 目录，看看我们有没有用到 "),s("code",[this._v("{!! !!}")]),this._v("：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:a(111),alt:"file"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_3-csrf-跨站请求伪造漏洞"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-csrf-跨站请求伪造漏洞","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. CSRF 跨站请求伪造漏洞")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("CSRF 漏洞的危害程度不低于 XSS，但是远没有 XSS 那样出名。一句话描述就是：利用用户的身份认证信息在用户当前"),s("strong",[this._v("已登录")]),this._v("的 Web 应用程序上执行非用户本意的操作。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("举个例子，假如 Laravel China 退出登录的请求方式和路由是 "),s("code",[this._v("Get /logout")]),this._v("，那么恶意用户只要在 LC 的帖子里插入一张图片，图片的 SRC 是 "),s("code",[this._v("https://laravel-china.org/logout")]),this._v("，那么任何访问这个帖子的用户都会被强制退出，因为浏览器在请求这个 URL 之前并不知道这个 URL 是不是一张真的图片，那么就会带着当前用户的 Cookie 用 Get 方式去请求这个退出页面，也就导致当前用户被强制退出。")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("form")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("action")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://laravel-china.org/logout"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("method")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("post"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("form"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("form")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{attrs:{class:"token script language-javascript"}},[t._v("document"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("gentElementById")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token string"}},[t._v("'form'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("submit")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")])]),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("敏感操作不能用 Get 请求方式；")]),s("li",[this._v("对于非 Get 的请求方式，需要校验请求中的 "),s("code",[this._v("token")]),this._v(" 字段，这个字段值对每个用户每次登录都是不一样的。")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("hidden"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("name")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("_token"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{attrs:{class:"token attr-name"}},[t._v("value")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{attrs:{class:"token punctuation"}},[t._v('"')]),t._v("{{ csrf_token() }}"),a("span",{attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_4-逻辑漏洞"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-逻辑漏洞","aria-hidden":"true"}},[this._v("#")]),this._v(" 4. 逻辑漏洞")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("app/Http/Requests/AddCartRequest.php:29")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'amount'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'required'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'integer'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'min:1'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("其中 "),s("code",[this._v("min:1")]),this._v(" 代表提交的商品数最少为 1。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("em",[this._v("app/Http/Requests/OrderRequest.php:39")])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'items.*.amount'")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("=")]),a("span",{attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'required'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'integer'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[t._v("'min:1'")]),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("同样要求 "),s("code",[this._v("min:1")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])}],e=a(0),r=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),a("p",[t._v("对于一个电商系统来说，安全性是一个很重要的指标，因为涉及到金钱交易，如果出现重大安全漏洞可能导致经济上的损失。")]),a("p",[t._v("本章节将要介绍网站的常见漏洞类型及原理，以及对我们的电商系统的安全检查。")]),t._m(1),t._m(2),a("p",[t._v("举个例子：")]),t._m(3),t._m(4),t._m(5),a("p",[t._v("很明显这个 SQL 查出来的结果必然为空，那么页面就会显示该商品不存在。")]),t._m(6),t._m(7),a("p",[t._v("执行的 SQL 就变成了：")]),t._m(8),t._m(9),t._m(10),t._m(11),a("p",[t._v("在 PHP 的项目里要避免 SQL 注入需要两个条件：")]),t._m(12),a("p",[t._v("Prepared Statement 简单来说就是把要执行的 SQL 与 SQL 里的参数分开，还是以上面的查询商品为例，Prepared Statement 就是：")]),t._m(13),t._m(14),a("p",[t._v("在 Laravel 里所有的 SQL 查询都是 Prepared Statement 模式，因此只要我们的代码中没有出现类似下方的代码，就不会存在 SQL 注入的风险：")]),t._m(15),t._m(16),t._m(17),a("p",[t._v("例如用户把以下内容作为收货地址提交：")]),t._m(18),a("p",[t._v("而如果我们在后台原样输出这个收货地址，就会触发网页 JS 代码，弹出一个 123 的提示框。")]),a("p",[t._v("在我们的项目中，有多处用户输入会保存到数据库中，并在之后输出到了页面中：")]),t._m(19),t._m(20),a("p",[t._v("在 Laravel 中要输出文本有两种方式："),a("code",[t._v(t._s(t.$str))]),t._v(" 和 "),a("code",[t._v("{!! $str !!}")]),t._v("，前者等同于 "),a("code",[t._v("echo htmlspecialchars($str)")]),t._v(" 而后者则是 "),a("code",[t._v("echo $str")]),t._v("，"),a("code",[t._v("htmlspecialchars()")]),t._v(" 函数默认会把 "),a("code",[t._v('<>&"')]),t._v(" 这个 4 个字符分别转义成 "),a("code",[t._v("<")]),t._v("、"),a("code",[t._v("&lgt;")]),t._v("、"),a("code",[t._v("&")]),t._v(" 和 "),a("code",[t._v('"')]),t._v("，因此我们只要保证我们一直在用 "),a("code",[t._v(t._s())]),t._v(" 来输出就没有问题。")]),t._m(21),t._m(22),a("p",[t._v("找到了两处，第一处是我们在实现商品搜索时，把用户的搜索条件以 JSON 格式输出到 JS 变量中，由于经过了一层 JSON 编码，所以是安全的；第二处是商品详情页输出商品详情，由于商品详情只能由我们的运营人员或者管理员来输入，因此不存在用户输入的风险。")]),t._m(23),t._m(24),t._m(25),a("p",[t._v("那么是不是把请求方式改成 Post 就没有问题了呢？确实无法通过图片的方式来触发，但是恶意用户可以在其他站点构造一个页面，内容如下：")]),t._m(26),a("p",[t._v("然后恶意用户诱导正常的用户去访问这个页面（比如这个恶意用户在 LC 的头条里分享了这个页面并取了一个很有诱惑的标题《教你如何实现一个千万并发的网站》，相信会有很多人访问），那么访问了这个页面的用户就会被强制退出 LC。")]),a("p",[t._v("如果一个银行网站的转账功能有 CSRF 漏洞，那么恶意用户就可以通过 CSRF 漏洞来盗取其他用户的资金。")]),a("p",[t._v("根据上面所说的原理，不难发现要避免 CSRF 攻击需要两个条件：")]),t._m(27),a("p",[t._v("对于 Laravel 项目来说已经内置了 CSRF 的防御手段，我们在写前端表单时都需要写一个")]),t._m(28),a("p",[t._v("来提交 CSRF Token，因此我们的项目不会有 CSRF 攻击的风险。")]),t._m(29),a("p",[t._v("对于电商系统，最常见的逻辑漏洞是添加负数个商品到购物车，如果没有做校验，并且有余额支付的渠道，那么恶意用户就可以通过下负数个商品的订单来增加自己的余额。")]),a("p",[t._v("首先我们系统并没有提供余额支付的逻辑，因此不存在这个问题。")]),a("p",[t._v("其次检查一下我们在添加商品到购物车和下单时的校验逻辑：")]),t._m(30),t._m(31),t._m(32),t._m(33),t._m(34),t._m(35),t._m(36),a("p",[t._v("由上面的这些漏洞及防御手段可以看到 Laravel 已经内置了绝大多数 Web 攻击的防御手段，只要我们牢记一些原则就能把绝大多数的安全风险扼杀在摇篮里。")])])},n,!1,null,null,null);s.default=r.exports}}]);